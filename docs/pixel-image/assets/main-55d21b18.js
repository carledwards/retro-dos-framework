(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();function Me(t,e){return!(t.x+t.width<=e.x||e.x+e.width<=t.x||t.y+t.height<=e.y||e.y+e.height<=t.y)}function Se(t,e){const n=Math.min(t.x,e.x),i=Math.min(t.y,e.y),s=Math.max(t.x+t.width,e.x+e.width),r=Math.max(t.y+t.height,e.y+e.height);return{x:n,y:i,width:s-n,height:r-i}}function De(t,e){const n=t.y===e.y&&t.height===e.height&&(t.x+t.width===e.x||e.x+e.width===t.x),i=t.x===e.x&&t.width===e.width&&(t.y+t.height===e.y||e.y+e.height===t.y);return n||i}class S{constructor(e=80,n=25){this.width=e,this.height=n,this.buffer=Array(n).fill(null).map(()=>Array(e).fill(null)),this.cursor={x:0,y:0,visible:!0,blinking:!0},this.dirtyRegions=[],this.batchRegions=[],this.batchMode=!1}writeChar(e,n,i,s){if(e<0||e>=this.width||n<0||n>=this.height)return;const r={char:i[0],attributes:s};this.buffer[n][e]=r,this.markDirty(e,n,1,1)}getChar(e,n){return e<0||e>=this.width||n<0||n>=this.height?null:this.buffer[n][e]}resize(e,n){const i=Array(n).fill(null).map(()=>Array(e).fill(null));for(let s=0;s<Math.min(n,this.height);s++)for(let r=0;r<Math.min(e,this.width);r++)i[s][r]=this.buffer[s][r];this.width=e,this.height=n,this.buffer=i,this.markDirty(0,0,e,n),this.cursor.x=Math.min(this.cursor.x,e-1),this.cursor.y=Math.min(this.cursor.y,n-1)}clear(){for(let e=0;e<this.height;e++)for(let n=0;n<this.width;n++)this.buffer[e][n]!==null&&this.markDirty(n,e,1,1);this.buffer=Array(this.height).fill(null).map(()=>Array(this.width).fill(null))}setCursorPosition(e,n){e<0||e>=this.width||n<0||n>=this.height||(this.markDirty(this.cursor.x,this.cursor.y,1,1),this.markDirty(e,n,1,1),this.cursor.x=e,this.cursor.y=n)}getCursorPosition(){return{x:this.cursor.x,y:this.cursor.y}}setCursorVisible(e){this.cursor.visible!==e&&(this.cursor.visible=e,this.markDirty(this.cursor.x,this.cursor.y,1,1))}setCursorBlinking(e){this.cursor.blinking!==e&&(this.cursor.blinking=e,this.markDirty(this.cursor.x,this.cursor.y,1,1))}beginBatch(){this.batchMode=!0,this.batchRegions=[]}endBatch(){this.batchMode=!1,this.batchRegions.length>0&&(this.optimizeAndAddRegions(this.batchRegions),this.batchRegions=[])}flush(){const e=[...this.dirtyRegions];return this.dirtyRegions=[],e}getBufferData(){if(this.cursor.visible&&this.cursor.blinking){const e=performance.now();(!this.cursor.lastBlinkTime||Math.floor(this.cursor.lastBlinkTime/500)!==Math.floor(e/500))&&(this.markDirty(this.cursor.x,this.cursor.y,1,1),this.cursor.lastBlinkTime=e)}return{width:this.width,height:this.height,cells:this.buffer,cursor:{...this.cursor}}}getDirtyRegions(){const e=[...this.dirtyRegions];return this.dirtyRegions=[],e}markDirty(e,n,i,s){const r={x:e,y:n,width:i,height:s};this.batchMode?this.batchRegions.push(r):this.optimizeAndAddRegions([r])}optimizeAndAddRegions(e){let n=[...this.dirtyRegions,...e],i=[],s;do{for(s=!1;n.length>0;){const r=n.pop();let c=!1;for(let h=0;h<i.length;h++)if(Me(r,i[h])||De(r,i[h])){i[h]=Se(r,i[h]),c=!0,s=!0;break}c||i.push(r)}s&&(n=i,i=[])}while(s);this.dirtyRegions=i}}function Pe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function U(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ve={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(){return function n(i,s,r){function c(g,o){if(!s[g]){if(!i[g]){var l=typeof U=="function"&&U;if(!o&&l)return l(g,!0);if(h)return h(g,!0);var u=new Error("Cannot find module '"+g+"'");throw u.code="MODULE_NOT_FOUND",u}var v=s[g]={exports:{}};i[g][0].call(v.exports,function(y){var p=i[g][1][y];return c(p||y)},v,v.exports,n,i,s,r)}return s[g].exports}for(var h=typeof U=="function"&&U,w=0;w<r.length;w++)c(r[w]);return c}({1:[function(n,i,s){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}i.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(o){if(!h(o)||o<0||isNaN(o))throw TypeError("n must be a positive number");return this._maxListeners=o,this},r.prototype.emit=function(o){var l,u,v,y,p,a;if(this._events||(this._events={}),o==="error"&&(!this._events.error||w(this._events.error)&&!this._events.error.length)){if(l=arguments[1],l instanceof Error)throw l;var f=new Error('Uncaught, unspecified "error" event. ('+l+")");throw f.context=l,f}if(u=this._events[o],g(u))return!1;if(c(u))switch(arguments.length){case 1:u.call(this);break;case 2:u.call(this,arguments[1]);break;case 3:u.call(this,arguments[1],arguments[2]);break;default:y=Array.prototype.slice.call(arguments,1),u.apply(this,y)}else if(w(u))for(y=Array.prototype.slice.call(arguments,1),a=u.slice(),v=a.length,p=0;p<v;p++)a[p].apply(this,y);return!0},r.prototype.addListener=function(o,l){var u;if(!c(l))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",o,c(l.listener)?l.listener:l),this._events[o]?w(this._events[o])?this._events[o].push(l):this._events[o]=[this._events[o],l]:this._events[o]=l,w(this._events[o])&&!this._events[o].warned&&(g(this._maxListeners)?u=r.defaultMaxListeners:u=this._maxListeners,u&&u>0&&this._events[o].length>u&&(this._events[o].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[o].length),typeof console.trace=="function"&&console.trace())),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(o,l){if(!c(l))throw TypeError("listener must be a function");var u=!1;function v(){this.removeListener(o,v),u||(u=!0,l.apply(this,arguments))}return v.listener=l,this.on(o,v),this},r.prototype.removeListener=function(o,l){var u,v,y,p;if(!c(l))throw TypeError("listener must be a function");if(!this._events||!this._events[o])return this;if(u=this._events[o],y=u.length,v=-1,u===l||c(u.listener)&&u.listener===l)delete this._events[o],this._events.removeListener&&this.emit("removeListener",o,l);else if(w(u)){for(p=y;p-- >0;)if(u[p]===l||u[p].listener&&u[p].listener===l){v=p;break}if(v<0)return this;u.length===1?(u.length=0,delete this._events[o]):u.splice(v,1),this._events.removeListener&&this.emit("removeListener",o,l)}return this},r.prototype.removeAllListeners=function(o){var l,u;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[o]&&delete this._events[o],this;if(arguments.length===0){for(l in this._events)l!=="removeListener"&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events={},this}if(u=this._events[o],c(u))this.removeListener(o,u);else if(u)for(;u.length;)this.removeListener(o,u[u.length-1]);return delete this._events[o],this},r.prototype.listeners=function(o){var l;return!this._events||!this._events[o]?l=[]:c(this._events[o])?l=[this._events[o]]:l=this._events[o].slice(),l},r.prototype.listenerCount=function(o){if(this._events){var l=this._events[o];if(c(l))return 1;if(l)return l.length}return 0},r.listenerCount=function(o,l){return o.listenerCount(l)};function c(o){return typeof o=="function"}function h(o){return typeof o=="number"}function w(o){return typeof o=="object"&&o!==null}function g(o){return o===void 0}},{}],2:[function(n,i,s){var r,c,h,w,g;g=navigator.userAgent.toLowerCase(),w=navigator.platform.toLowerCase(),r=g.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],h=r[1]==="ie"&&document.documentMode,c={name:r[1]==="version"?r[3]:r[1],version:h||parseFloat(r[1]==="opera"&&r[4]?r[4]:r[2]),platform:{name:g.match(/ip(?:ad|od|hone)/)?"ios":(g.match(/(?:webos|android)/)||w.match(/mac|win|linux/)||["other"])[0]}},c[c.name]=!0,c[c.name+parseInt(c.version,10)]=!0,c.platform[c.platform.name]=!0,i.exports=c},{}],3:[function(n,i,s){var r,c,h,w=function(u,v){for(var y in v)g.call(v,y)&&(u[y]=v[y]);function p(){this.constructor=u}return p.prototype=v.prototype,u.prototype=new p,u.__super__=v.prototype,u},g={}.hasOwnProperty,o=[].indexOf||function(u){for(var v=0,y=this.length;v<y;v++)if(v in this&&this[v]===u)return v;return-1},l=[].slice;r=n("events").EventEmitter,h=n("./browser.coffee"),c=function(u){var v,y;w(p,u),v={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},y={delay:500,copy:!1};function p(a){var f,d,m;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(a);for(d in v)m=v[d],(f=this.options)[d]==null&&(f[d]=m)}return p.prototype.setOption=function(a,f){if(this.options[a]=f,this._canvas!=null&&(a==="width"||a==="height"))return this._canvas[a]=f},p.prototype.setOptions=function(a){var f,d,m;d=[];for(f in a)g.call(a,f)&&(m=a[f],d.push(this.setOption(f,m)));return d},p.prototype.addFrame=function(a,f){var d,m;f==null&&(f={}),d={},d.transparent=this.options.transparent;for(m in y)d[m]=f[m]||y[m];if(this.options.width==null&&this.setOption("width",a.width),this.options.height==null&&this.setOption("height",a.height),typeof ImageData<"u"&&ImageData!==null&&a instanceof ImageData)d.data=a.data;else if(typeof CanvasRenderingContext2D<"u"&&CanvasRenderingContext2D!==null&&a instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext<"u"&&WebGLRenderingContext!==null&&a instanceof WebGLRenderingContext)f.copy?d.data=this.getContextData(a):d.context=a;else if(a.childNodes!=null)f.copy?d.data=this.getImageData(a):d.image=a;else throw new Error("Invalid image");return this.frames.push(d)},p.prototype.render=function(){var a,f,d;if(this.running)throw new Error("Already running");if(this.options.width==null||this.options.height==null)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=(function(){var m,C,b;for(b=[],m=0,C=this.frames.length;0<=C?m<C:m>C;0<=C?++m:--m)b.push(null);return b}).call(this),f=this.spawnWorkers(),this.options.globalPalette===!0)this.renderNextFrame();else for(a=0,d=f;0<=d?a<d:a>d;0<=d?++a:--a)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},p.prototype.abort=function(){for(var a;a=this.activeWorkers.shift(),a!=null;)this.log("killing active worker"),a.terminate();return this.running=!1,this.emit("abort")},p.prototype.spawnWorkers=function(){var a,f,d;return a=Math.min(this.options.workers,this.frames.length),(function(){d=[];for(var m=f=this.freeWorkers.length;f<=a?m<a:m>a;f<=a?m++:m--)d.push(m);return d}).apply(this).forEach(function(m){return function(C){var b;return m.log("spawning worker "+C),b=new Worker(m.options.workerScript),b.onmessage=function(_){return m.activeWorkers.splice(m.activeWorkers.indexOf(b),1),m.freeWorkers.push(b),m.frameFinished(_.data)},m.freeWorkers.push(b)}}(this)),a},p.prototype.frameFinished=function(a){var f,d;if(this.log("frame "+a.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[a.index]=a,this.options.globalPalette===!0&&(this.options.globalPalette=a.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(f=1,d=this.freeWorkers.length;1<=d?f<d:f>d;1<=d?++f:--f)this.renderNextFrame();return o.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},p.prototype.finishRendering=function(){var a,f,d,m,C,b,_,R,z,q,N,P,he,Z,H,ee;for(R=0,Z=this.imageParts,C=0,z=Z.length;C<z;C++)f=Z[C],R+=(f.data.length-1)*f.pageSize+f.cursor;for(R+=f.pageSize-f.cursor,this.log("rendering finished - filesize "+Math.round(R/1e3)+"kb"),a=new Uint8Array(R),P=0,H=this.imageParts,b=0,q=H.length;b<q;b++)for(f=H[b],ee=f.data,d=_=0,N=ee.length;_<N;d=++_)he=ee[d],a.set(he,P),d===f.data.length-1?P+=f.cursor:P+=f.pageSize;return m=new Blob([a],{type:"image/gif"}),this.emit("finished",m,a)},p.prototype.renderNextFrame=function(){var a,f,d;if(this.freeWorkers.length===0)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return a=this.frames[this.nextFrame++],d=this.freeWorkers.shift(),f=this.getTask(a),this.log("starting frame "+(f.index+1)+" of "+this.frames.length),this.activeWorkers.push(d),d.postMessage(f)},p.prototype.getContextData=function(a){return a.getImageData(0,0,this.options.width,this.options.height).data},p.prototype.getImageData=function(a){var f;return this._canvas==null&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),f=this._canvas.getContext("2d"),f.setFill=this.options.background,f.fillRect(0,0,this.options.width,this.options.height),f.drawImage(a,0,0),this.getContextData(f)},p.prototype.getTask=function(a){var f,d;if(f=this.frames.indexOf(a),d={index:f,last:f===this.frames.length-1,delay:a.delay,transparent:a.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:h.name==="chrome"},a.data!=null)d.data=a.data;else if(a.context!=null)d.data=this.getContextData(a.context);else if(a.image!=null)d.data=this.getImageData(a.image);else throw new Error("Invalid frame");return d},p.prototype.log=function(){var a;if(a=1<=arguments.length?l.call(arguments,0):[],!!this.options.debug)return console.log.apply(console,a)},p}(r),i.exports=c},{"./browser.coffee":2,events:1}]},{},[3])(3)})})(ve);var Fe=ve.exports;const Te=Pe(Fe),Ae=document.getElementById("imageInput"),ye=document.querySelector(".gif-dialog"),ie=document.getElementById("gifStartSize"),j=document.getElementById("gifEndSize"),Oe=document.getElementById("gifFrameCount"),we=document.getElementById("gifAnimationType"),xe=document.getElementById("gifDelay"),be=document.getElementById("gifLoopPause"),We=document.getElementById("gifTimingCurve"),ze=document.getElementById("gifColorPalette"),qe=document.getElementById("gifColorMode"),Ne=document.getElementById("gifPreview"),Ue=document.querySelector(".gif-preview-btn"),je=document.querySelector(".gif-save"),Ge=document.querySelector(".gif-cancel");let G=[],M=null;const $e=document.getElementById("gifBuilder"),I=document.getElementById("fullImage"),$=document.getElementById("screenFull"),V=document.getElementById("screen256"),Y=document.getElementById("screen16"),X=document.getElementById("screenFullBW"),K=document.getElementById("screen256BW"),J=document.getElementById("screen16BW"),Ve=I.getContext("2d");$.getContext("2d");V.getContext("2d");Y.getContext("2d");X.getContext("2d");K.getContext("2d");J.getContext("2d");var ue,fe,de,ge,pe,me;const k=[{canvas:$,buffer:null,overlay:(ue=$.parentElement)==null?void 0:ue.querySelector(".rendering-overlay")},{canvas:V,buffer:null,overlay:(fe=V.parentElement)==null?void 0:fe.querySelector(".rendering-overlay")},{canvas:Y,buffer:null,overlay:(de=Y.parentElement)==null?void 0:de.querySelector(".rendering-overlay")},{canvas:X,buffer:null,overlay:(ge=X.parentElement)==null?void 0:ge.querySelector(".rendering-overlay")},{canvas:K,buffer:null,overlay:(pe=K.parentElement)==null?void 0:pe.querySelector(".rendering-overlay")},{canvas:J,buffer:null,overlay:(me=J.parentElement)==null?void 0:me.querySelector(".rendering-overlay")}],ne=document.getElementById("gridSize");let x=parseInt(ne.value),D=null,L=document.querySelector(".selection-box"),O=!1,W=!1,E=null,Ie=0,Ce=0,B=0,T=0,A=0,F=null,te=!1;const Q=[[0,0,0],[0,0,170],[0,170,0],[0,170,170],[170,0,0],[170,0,170],[170,85,0],[170,170,170],[85,85,85],[85,85,255],[85,255,85],[85,255,255],[255,85,85],[255,85,255],[255,255,85],[255,255,255]];function Ye(){const t=[];for(let e=0;e<32;e++){const n=Math.round(e*255/31);for(let i=0;i<64;i++){const s=Math.round(i*255/63);for(let r=0;r<32;r++){const c=Math.round(r*255/31);t.push([n,s,c])}}}return t}function Xe(){const t=[];for(let e=0;e<6;e++)for(let n=0;n<6;n++)for(let i=0;i<6;i++)t.push([Math.round(e*51),Math.round(n*51),Math.round(i*51)]);for(let e=0;e<40;e++){const n=Math.round(e*255/39);t.push([n,n,n])}return t}const se=Ye(),oe=Xe();function Ke(){switch(ze.value){case"16bit":return se;case"256":return oe;case"16":return Q;default:return Q}}function Je(t,e,n){return Math.round(.299*t+.587*e+.114*n)}function Ee(t,e,n,i,s=!1){s&&(t=e=n=Je(t,e,n));let r=1/0,c=0;for(let h=0;h<i.length;h++){const[w,g,o]=i[h],l=Math.sqrt(Math.pow(t-w,2)+Math.pow(e-g,2)+Math.pow(n-o,2));l<r&&(r=l,c=h)}return c}function ke(t,e,n){const i=We.value,s=e/n;switch(i){case"linear":return t*(2-s);case"curved":return t*(1+(1-s)*(1-s));default:return t}}function ae(t,e,n){return Math.round(t+(e-t)*n)}function Le(t){const e=I.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}function Qe(t,e,n){const i=I.width,s=I.height,r=I.getBoundingClientRect().width/i;return t=Math.max(0,Math.min(t,i*r-n)),e=Math.max(0,Math.min(e,s*r-n)),{left:t,top:e}}function re(t,e,n){const{left:i,top:s}=Qe(t,e,n);L.style.left=`${i}px`,L.style.top=`${s}px`,L.style.width=`${n}px`,L.style.height=`${n}px`}function Ze(){if(!D)return;const t=I.getBoundingClientRect(),e=Math.min(t.width,t.height),n=(t.width-e)/2,i=(t.height-e)/2;re(n,i,e)}function He(t){t.classList.add("active")}function et(t){t.classList.remove("active")}async function tt(t,e,n,i,s,r){return new Promise(c=>{He(r);let h=0;const w=8;function g(){const o=Math.min(h+w,x);for(;h<o;h++)for(let l=0;l<x;l++){const u=(h*x+l)*4,v=t.data[u],y=t.data[u+1],p=t.data[u+2],a=Ee(v,y,p,i,s);e.writeChar(l,h," ",{foreground:0,background:a})}h<x?requestAnimationFrame(g):(le(e,n,i),et(r),c())}g()})}function le(t,e,n,i){const{cells:s}=t.getBufferData(),r=i||x;e.fillStyle="#000",e.fillRect(0,0,e.canvas.width,e.canvas.height);for(let c=0;c<r;c++)for(let h=0;h<r;h++){const w=s[c][h];if(w){const g=n[w.attributes.background];e.fillStyle=`rgb(${g[0]}, ${g[1]}, ${g[2]})`,e.fillRect(h,c,1,1)}}}async function nt(){if(!D)return;const t=I.getBoundingClientRect(),e=I.width/t.width,n=L.getBoundingClientRect(),i={left:(n.left-t.left)*e,top:(n.top-t.top)*e,width:n.width*e,height:n.height*e},s=document.createElement("canvas");s.width=x,s.height=x;const r=s.getContext("2d");r.drawImage(I,i.left,i.top,i.width,i.height,0,0,x,x);const c=r.getImageData(0,0,x,x);for(let h=0;h<k.length;h++){const w=k[h];if(w.buffer){const g=h%3===0?se:h%3===1?oe:Q,o=h>=3;await tt(c,w.buffer,w.canvas.getContext("2d"),g,o,w.overlay),h<k.length-1&&await new Promise(l=>setTimeout(l,100))}}}function rt(t){D=t;const e=t.width/t.height;I.width=800,I.height=Math.round(800/e),Ve.drawImage(t,0,0,I.width,I.height),Ze(),ce()}function _e(t){const e=new Image,n=new FileReader;n.onload=i=>{var s;(s=i.target)!=null&&s.result&&(e.src=i.target.result,e.onload=()=>rt(e))},n.readAsDataURL(t)}function ce(){F!==null&&(window.clearTimeout(F),F=null),F=window.setTimeout(async()=>{te||(te=!0,await nt(),te=!1,F=null)},1e3)}function Re(){[$,V,Y,X,K,J].forEach(t=>{t.width=x,t.height=x}),k[0].buffer=new S(x,x),k[1].buffer=new S(x,x),k[2].buffer=new S(x,x),k[3].buffer=new S(x,x),k[4].buffer=new S(x,x),k[5].buffer=new S(x,x),k.forEach(t=>{t.buffer&&(t.buffer.clear(),t.buffer.setCursorVisible(!1))})}function Be(){k.forEach((t,e)=>{if(t.buffer){const n=e%3===0?se:e%3===1?oe:Q;le(t.buffer,t.canvas.getContext("2d"),n)}})}async function it(t,e,n){const i=Ke(),s=qe.value==="bw",r=[],c=document.createElement("canvas");c.width=256,c.height=256;const h=c.getContext("2d");h.imageSmoothingEnabled=!1;const w=I.getBoundingClientRect(),g=I.width/w.width,o=L.getBoundingClientRect(),l={left:(o.left-w.left)*g,top:(o.top-w.top)*g,width:o.width*g,height:o.height*g};for(let u=0;u<n;u++){const v=u/(n-1),y=ae(t,e,v),p=document.createElement("canvas");p.width=y,p.height=y;const a=p.getContext("2d");a.drawImage(I,l.left,l.top,l.width,l.height,0,0,y,y);const f=new S(y,y),d=a.getImageData(0,0,y,y);for(let b=0;b<y;b++)for(let _=0;_<y;_++){const R=(b*y+_)*4,z=d.data[R],q=d.data[R+1],N=d.data[R+2],P=Ee(z,q,N,i,s);f.writeChar(_,b," ",{foreground:0,background:P})}const m=document.createElement("canvas");m.width=y,m.height=y;const C=m.getContext("2d");le(f,C,i,y),h.clearRect(0,0,256,256),h.drawImage(m,0,0,256,256),r.push(h.getImageData(0,0,256,256))}return r}function st(t,e,n){const i=Ne.getContext("2d");let s=!0,r=0,c=0;const h=parseInt(be.value);M!==null&&window.clearInterval(M),M=window.setInterval(()=>{if(c>0){c--;return}i.putImageData(t[r],0,0);const w=ae(parseInt(ie.value),parseInt(j.value),r/(t.length-1)),g=ke(e,w,parseInt(j.value));n==="once"?(r=(r+1)%t.length,r===0&&(window.clearInterval(M),M=null)):n==="loop"?(r=(r+1)%t.length,r===0&&h>0&&(c=Math.floor(h/g))):n==="bounce"&&(s?(r++,r>=t.length-1&&(s=!1,h>0&&(c=Math.floor(h/g)))):(r--,r<=0&&(s=!0,h>0&&(c=Math.floor(h/g)))))},e)}function ot(t,e,n){const i=new Te({workers:2,quality:10,width:256,height:256,workerScript:"gif.worker.js",repeat:n==="once"?1:0}),s=document.createElement("canvas");s.width=256,s.height=256;const r=s.getContext("2d"),c=parseInt(be.value),h=parseInt(ie.value),w=parseInt(j.value),g=(o,l)=>{r.putImageData(o,0,0);const u=ae(h,w,l),v=ke(e,u,w);i.addFrame(s,{delay:v,copy:!0})};if(n==="bounce"){t.forEach((o,l)=>{g(o,l/(t.length-1))}),c>0&&(r.putImageData(t[t.length-1],0,0),i.addFrame(s,{delay:c,copy:!0}));for(let o=t.length-2;o>0;o--)g(t[o],o/(t.length-1));c>0&&(r.putImageData(t[0],0,0),i.addFrame(s,{delay:c,copy:!0}))}else t.forEach((o,l)=>{g(o,l/(t.length-1)),c>0&&l===t.length-1&&(r.putImageData(o,0,0),i.addFrame(s,{delay:c,copy:!0}))});i.on("finished",o=>{const l=URL.createObjectURL(o),u=document.createElement("a");u.download="pixel-animation.gif",u.href=l,u.click(),URL.revokeObjectURL(l)}),i.render()}Ae.addEventListener("change",t=>{const e=t.target.files;e&&e[0]&&_e(e[0])});document.addEventListener("paste",t=>{var n;const e=(n=t.clipboardData)==null?void 0:n.items;if(e){for(const i of e)if(i.type.indexOf("image")!==-1){const s=i.getAsFile();if(s){_e(s);break}}}});ne.addEventListener("change",()=>{x=parseInt(ne.value),Re(),D?ce():Be()});L.addEventListener("mousedown",t=>{if(!D)return;const e=t.target;e.classList.contains("selection-handle")?(W=!0,E=e):O=!0;const n=Le(t);Ie=n.x,Ce=n.y,T=parseFloat(L.style.left)||0,A=parseFloat(L.style.top)||0,B=parseFloat(L.style.width)||0,parseFloat(L.style.height),t.preventDefault()});document.addEventListener("mousemove",t=>{if(!D||!O&&!W)return;const e=Le(t),n=e.x-Ie,i=e.y-Ce;if(O)re(T+n,A+i,B);else if(W){let s=B,r=T,c=A;if(E!=null&&E.classList.contains("se"))s=Math.max(B+n,B+i);else if(E!=null&&E.classList.contains("sw")){const h=Math.max(-n,i);s=B+h,r=T-h}else if(E!=null&&E.classList.contains("ne")){const h=Math.max(n,-i);s=B+h,c=A-h}else if(E!=null&&E.classList.contains("nw")){const h=Math.max(-n,-i);s=B+h,r=T-h,c=A-h}re(r,c,s)}});document.addEventListener("mouseup",()=>{(O||W)&&(O=!1,W=!1,E=null,ce())});$e.addEventListener("click",()=>{if(!D){alert("Please import an image first");return}ye.style.display="flex"});Ue.addEventListener("click",async()=>{const t=parseInt(ie.value),e=parseInt(j.value),n=parseInt(Oe.value),i=parseInt(xe.value),s=we.value;G=await it(t,e,n),st(G,i,s)});je.addEventListener("click",()=>{if(G.length===0){alert("Please preview the animation first");return}const t=parseInt(xe.value),e=we.value;ot(G,t,e)});Ge.addEventListener("click",()=>{M!==null&&(window.clearInterval(M),M=null),ye.style.display="none"});Re();Be();
