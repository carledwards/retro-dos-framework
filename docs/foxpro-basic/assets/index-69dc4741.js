(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&e(n)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();var f=(r=>(r.MOUSE_MOVE="MOUSE_MOVE",r.MOUSE_DOWN="MOUSE_DOWN",r.MOUSE_UP="MOUSE_UP",r.MOUSE_DRAG="MOUSE_DRAG",r.MOUSE_DOUBLE_CLICK="MOUSE_DOUBLE_CLICK",r.KEY_DOWN="KEY_DOWN",r.KEY_UP="KEY_UP",r))(f||{});function P(r,t){return!(r.x+r.width<=t.x||t.x+t.width<=r.x||r.y+r.height<=t.y||t.y+t.height<=r.y)}function E(r,t){const i=Math.min(r.x,t.x),e=Math.min(r.y,t.y),s=Math.max(r.x+r.width,t.x+t.width),o=Math.max(r.y+r.height,t.y+t.height);return{x:i,y:e,width:s-i,height:o-e}}function U(r,t){const i=r.y===t.y&&r.height===t.height&&(r.x+r.width===t.x||t.x+t.width===r.x),e=r.x===t.x&&r.width===t.width&&(r.y+r.height===t.y||t.y+t.height===r.y);return i||e}var T=class{constructor(r=80,t=25){this.width=r,this.height=t,this.buffer=Array(t).fill(null).map(()=>Array(r).fill(null)),this.cursor={x:0,y:0,visible:!0,blinking:!0},this.dirtyRegions=[],this.batchRegions=[],this.batchMode=!1}writeChar(r,t,i,e){if(r<0||r>=this.width||t<0||t>=this.height)return;const s={char:i[0],attributes:e};this.buffer[t][r]=s,this.markDirty(r,t,1,1)}getChar(r,t){return r<0||r>=this.width||t<0||t>=this.height?null:this.buffer[t][r]}resize(r,t){const i=Array(t).fill(null).map(()=>Array(r).fill(null));for(let e=0;e<Math.min(t,this.height);e++)for(let s=0;s<Math.min(r,this.width);s++)i[e][s]=this.buffer[e][s];this.width=r,this.height=t,this.buffer=i,this.markDirty(0,0,r,t),this.cursor.x=Math.min(this.cursor.x,r-1),this.cursor.y=Math.min(this.cursor.y,t-1)}clear(){for(let r=0;r<this.height;r++)for(let t=0;t<this.width;t++)this.buffer[r][t]!==null&&this.markDirty(t,r,1,1);this.buffer=Array(this.height).fill(null).map(()=>Array(this.width).fill(null))}setCursorPosition(r,t){r<0||r>=this.width||t<0||t>=this.height||(this.markDirty(this.cursor.x,this.cursor.y,1,1),this.markDirty(r,t,1,1),this.cursor.x=r,this.cursor.y=t)}getCursorPosition(){return{x:this.cursor.x,y:this.cursor.y}}setCursorVisible(r){this.cursor.visible!==r&&(this.cursor.visible=r,this.markDirty(this.cursor.x,this.cursor.y,1,1))}setCursorBlinking(r){this.cursor.blinking!==r&&(this.cursor.blinking=r,this.markDirty(this.cursor.x,this.cursor.y,1,1))}beginBatch(){this.batchMode=!0,this.batchRegions=[]}endBatch(){this.batchMode=!1,this.batchRegions.length>0&&(this.optimizeAndAddRegions(this.batchRegions),this.batchRegions=[])}flush(){const r=[...this.dirtyRegions];return this.dirtyRegions=[],r}getBufferData(){if(this.cursor.visible&&this.cursor.blinking){const r=performance.now();(!this.cursor.lastBlinkTime||Math.floor(this.cursor.lastBlinkTime/500)!==Math.floor(r/500))&&(this.markDirty(this.cursor.x,this.cursor.y,1,1),this.cursor.lastBlinkTime=r)}return{width:this.width,height:this.height,cells:this.buffer,cursor:{...this.cursor}}}getDirtyRegions(){const r=[...this.dirtyRegions];return this.dirtyRegions=[],r}markDirty(r,t,i,e){const s={x:r,y:t,width:i,height:e};this.batchMode?this.batchRegions.push(s):this.optimizeAndAddRegions([s])}optimizeAndAddRegions(r){let t=[...this.dirtyRegions,...r],i=[],e;do{for(e=!1;t.length>0;){const s=t.pop();let o=!1;for(let n=0;n<i.length;n++)if(P(s,i[n])||U(s,i[n])){i[n]=E(s,i[n]),o=!0,e=!0;break}o||i.push(s)}e&&(t=i,i=[])}while(e);this.dirtyRegions=i}},F=class{constructor(){this.handlers=new Map,this.priorityThresholds=new Map}subscribe(r,t={}){const{eventTypes:i,minPriority:e=0}=t,s=i||["*"];return s.forEach(o=>{this.handlers.has(o)||this.handlers.set(o,new Set),this.handlers.get(o).add(r),e>0&&this.priorityThresholds.set(o,e)}),()=>{s.forEach(o=>{const n=this.handlers.get(o);n&&(n.delete(r),n.size===0&&(this.handlers.delete(o),this.priorityThresholds.delete(o)))})}}publish(r){r.timestamp||(r.timestamp=Date.now());const t=this.priorityThresholds.get(r.type)||0;if(r.priority>=t){const i=this.handlers.get(r.type);i&&i.forEach(s=>s(r));const e=this.handlers.get("*");e&&e.forEach(s=>s(r))}}clear(){this.handlers.clear(),this.priorityThresholds.clear()}},y=new F,K=class{constructor(){this.state={lastKeyPressed:null,modifiers:{ctrl:!1,alt:!1,shift:!1,meta:!1}},this.listeners=new Set,this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this)}initialize(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}cleanup(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)}handleKeyDown(r){this.state.modifiers={ctrl:r.ctrlKey,alt:r.altKey,shift:r.shiftKey,meta:r.metaKey},this.state.lastKeyPressed=r.key;const t={type:"KEY_DOWN",timestamp:Date.now(),priority:100,source:"keyboard",data:{key:r.key,modifiers:this.state.modifiers}};y.publish(t),this.notifyListeners()}handleKeyUp(r){this.state.modifiers={ctrl:r.ctrlKey,alt:r.altKey,shift:r.shiftKey,meta:r.metaKey},this.state.lastKeyPressed===r.key&&(this.state.lastKeyPressed=null);const t={type:"KEY_UP",timestamp:Date.now(),priority:100,source:"keyboard",data:{key:r.key,modifiers:this.state.modifiers}};y.publish(t),this.notifyListeners()}addListener(r){this.listeners.add(r)}removeListener(r){this.listeners.delete(r)}notifyListeners(){this.listeners.forEach(r=>r(this.state))}getState(){return{...this.state}}},S=class k{constructor(t,i){this.keyboardService=i,this.element=t,this.state={position:null,isVisible:!1,isButtonDown:!1,modifiers:{ctrl:!1,alt:!1,shift:!1,meta:!1}},this.listeners=new Set,this.lastPosition=null,this.lastClickTime=0,this.lastClickPosition=null,this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),this.handleMouseEnter=this.handleMouseEnter.bind(this)}initialize(){this.element.addEventListener("mousemove",this.handleMouseMove),this.element.addEventListener("mousedown",this.handleMouseDown),this.element.addEventListener("mouseup",this.handleMouseUp),this.element.addEventListener("mouseleave",this.handleMouseLeave),this.element.addEventListener("mouseenter",this.handleMouseEnter)}cleanup(){this.element.removeEventListener("mousemove",this.handleMouseMove),this.element.removeEventListener("mousedown",this.handleMouseDown),this.element.removeEventListener("mouseup",this.handleMouseUp),this.element.removeEventListener("mouseleave",this.handleMouseLeave),this.element.removeEventListener("mouseenter",this.handleMouseEnter)}handleMouseEnter(t){const i=this.screenToBuffer(t.clientX,t.clientY);this.state.position=i,this.lastPosition={...i},this.state.isVisible=!0,this.state.modifiers={ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey,meta:t.metaKey};const e={type:"MOUSE_MOVE",timestamp:Date.now(),priority:100,source:"mouse",data:{position:i,isButtonDown:this.state.isButtonDown,modifiers:this.state.modifiers,isVisible:this.state.isVisible}};y.publish(e),this.notifyListeners()}handleMouseLeave(t){const i=this.lastPosition?{...this.lastPosition}:null;if(this.state.isVisible=!1,this.state.position=null,this.lastPosition=null,this.state.isButtonDown=!1,i){const e={type:"MOUSE_MOVE",timestamp:Date.now(),priority:100,source:"mouse",data:{position:i,isButtonDown:!1,modifiers:this.state.modifiers,isVisible:!1}};y.publish(e)}this.notifyListeners()}screenToBuffer(t,i){const s=this.element.getBoundingClientRect(),o=t-s.left,n=i-s.top,h=s.width/80,d=s.height/25,g=Math.floor(o/h),u=Math.floor(n/d);return{x:Math.max(0,Math.min(g,79)),y:Math.max(0,Math.min(u,24))}}hasPositionChanged(t,i){return t?t.x!==i.x||t.y!==i.y:!0}handleMouseMove(t){const i=this.element.getBoundingClientRect(),e=t.clientX-i.left,s=t.clientY-i.top;if(e<0||e>=i.width||s<0||s>=i.height){const n=this.lastPosition?{...this.lastPosition}:null;if(this.state.isVisible=!1,this.state.position=null,this.lastPosition=null,this.state.isButtonDown=!1,n){const h={type:"MOUSE_MOVE",timestamp:Date.now(),priority:100,source:"mouse",data:{position:n,isButtonDown:!1,modifiers:this.state.modifiers,isVisible:!1}};y.publish(h)}this.notifyListeners();return}const o=this.screenToBuffer(t.clientX,t.clientY);if(this.hasPositionChanged(this.state.position,o)){this.state.isVisible||(this.state.isVisible=!0),this.state.position=o,this.lastPosition={...o},this.state.modifiers={ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey,meta:t.metaKey};const n={type:this.state.isButtonDown?"MOUSE_DRAG":"MOUSE_MOVE",timestamp:Date.now(),priority:100,source:"mouse",data:{position:o,isButtonDown:this.state.isButtonDown,modifiers:this.state.modifiers,isVisible:this.state.isVisible}};y.publish(n),this.notifyListeners()}}isWithinDoubleClickDistance(t,i){const e=Math.abs(t.x-i.x),s=Math.abs(t.y-i.y);return e<=k.DOUBLE_CLICK_DISTANCE&&s<=k.DOUBLE_CLICK_DISTANCE}handleMouseDown(t){const i=this.element.getBoundingClientRect(),e=t.clientX-i.left,s=t.clientY-i.top;if(e>=0&&e<i.width&&s>=0&&s<i.height){const o=this.screenToBuffer(t.clientX,t.clientY),n=Date.now();this.state.position=o,this.lastPosition={...o},this.state.isButtonDown=!0,this.state.isVisible=!0,this.state.modifiers={ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey,meta:t.metaKey};const h={type:"MOUSE_DOWN",timestamp:n,priority:100,source:"mouse",data:{position:o,isButtonDown:!0,modifiers:this.state.modifiers,isVisible:this.state.isVisible}};if(y.publish(h),this.lastClickPosition&&n-this.lastClickTime<=k.DOUBLE_CLICK_TIMEOUT&&this.isWithinDoubleClickDistance(o,this.lastClickPosition)){const d={type:"MOUSE_DOUBLE_CLICK",timestamp:n,priority:100,source:"mouse",data:{position:o,isButtonDown:!0,modifiers:{ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey,meta:t.metaKey},isVisible:!0}};y.publish(d),this.lastClickTime=0,this.lastClickPosition=null}else this.lastClickTime=n,this.lastClickPosition={...o};this.notifyListeners()}}handleMouseUp(t){const i=this.screenToBuffer(t.clientX,t.clientY),e=this.isInBounds(t.clientX,t.clientY);if(this.state.isButtonDown=!1,e&&(this.state.position=i,this.lastPosition={...i},this.state.isVisible=!0),this.state.modifiers={ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey,meta:t.metaKey},e){const s={type:"MOUSE_UP",timestamp:Date.now(),priority:100,source:"mouse",data:{position:i,isButtonDown:!1,modifiers:this.state.modifiers,isVisible:this.state.isVisible}};y.publish(s)}this.notifyListeners()}isInBounds(t,i){const e=this.element.getBoundingClientRect(),s=t-e.left,o=i-e.top;return s>=0&&s<e.width&&o>=0&&o<e.height}addListener(t){this.listeners.add(t)}removeListener(t){this.listeners.delete(t)}notifyListeners(){this.listeners.forEach(t=>t(this.state))}getState(){return{...this.state}}};S.DOUBLE_CLICK_TIMEOUT=500;S.DOUBLE_CLICK_DISTANCE=1;var _=S,V=class x{constructor(t,i=4,e=10,s=0){this.objects=[],this.nodes=[],this.bounds=t,this.maxDepth=i,this.maxObjects=e,this.depth=s}clear(){this.objects=[],this.nodes.forEach(t=>t.clear()),this.nodes=[]}split(){const t=this.bounds.width/2,i=this.bounds.height/2,e=this.bounds.x,s=this.bounds.y;this.nodes=[new x({x:e+t,y:s,width:t,height:i},this.maxDepth,this.maxObjects,this.depth+1),new x({x:e,y:s,width:t,height:i},this.maxDepth,this.maxObjects,this.depth+1),new x({x:e,y:s+i,width:t,height:i},this.maxDepth,this.maxObjects,this.depth+1),new x({x:e+t,y:s+i,width:t,height:i},this.maxDepth,this.maxObjects,this.depth+1)]}getIndex(t){const i=this.bounds.x+this.bounds.width/2,e=this.bounds.y+this.bounds.height/2,s=t.y<e&&t.y+t.height<e,o=t.y>e;if(t.x<i&&t.x+t.width<i){if(s)return 1;if(o)return 2}else if(t.x>i){if(s)return 0;if(o)return 3}return-1}insert(t){if(this.nodes.length>0){const i=this.getIndex(t);if(i!==-1){this.nodes[i].insert(t);return}}if(this.objects.push(t),this.objects.length>this.maxObjects&&this.depth<this.maxDepth){this.nodes.length===0&&this.split();let i=0;for(;i<this.objects.length;){const e=this.getIndex(this.objects[i]);if(e!==-1){const s=this.objects.splice(i,1)[0];this.nodes[e].insert(s)}else i++}}}retrieve(t){const i=this.getIndex(t);let e=this.objects;if(this.nodes.length>0)if(i!==-1)e=e.concat(this.nodes[i].retrieve(t));else for(const s of this.nodes)e=e.concat(s.retrieve(t));return e}mergeRegions(){const t=this.getAllRegions(),i=[];for(;t.length>0;){let e=t.pop(),s=!0;for(;s;){s=!1;for(let o=t.length-1;o>=0;o--){const n=t[o];this.canMergeRegions(e,n)&&(e=this.mergeRegion(e,n),t.splice(o,1),s=!0)}}i.push(e)}return i}getAllRegions(){let t=[...this.objects];for(const i of this.nodes)t=t.concat(i.getAllRegions());return t}canMergeRegions(t,i){return!(t.x+t.width<i.x||i.x+i.width<t.x||t.y+t.height<i.y||i.y+i.height<t.y)}mergeRegion(t,i){const e=Math.min(t.x,i.x),s=Math.min(t.y,i.y),o=Math.max(t.x+t.width,i.x+i.width)-e,n=Math.max(t.y+t.height,i.y+i.height)-s;return{x:e,y:s,width:o,height:n}}},H=class{constructor(r,t){this.videoBuffer=r,this.bufferSize={width:t.width,height:t.height},this.maxDepth=t.maxDepth||4,this.maxObjects=t.maxObjects||10,this.layers=new Map}registerLayer(r){this.layers.set(r.id,{...r,dirtyRegions:new V({x:0,y:0,width:this.bufferSize.width,height:this.bufferSize.height},this.maxDepth,this.maxObjects)})}markDirty(r,t){const i=this.layers.get(r);i&&i.dirtyRegions.insert(t)}isInBounds(r,t){return r>=0&&r<this.bufferSize.width&&t>=0&&t<this.bufferSize.height}getVisibleRegion(r){const t=Math.max(0,r.x),i=Math.max(0,r.y),e=Math.min(r.x+r.width,this.bufferSize.width),s=Math.min(r.y+r.height,this.bufferSize.height);return e<=t||s<=i?null:{x:t,y:i,width:e-t,height:s-i}}writeContent(r,t,i){this.isInBounds(r,t)&&this.videoBuffer.writeChar(r,t,i.char,i.attributes)}getDirtyRegions(r){const t=this.layers.get(r);return t?t.dirtyRegions.mergeRegions():[]}clearDirtyRegions(r){const t=this.layers.get(r);t&&t.dirtyRegions.clear()}setLayerVisibility(r,t){const i=this.layers.get(r);i&&(i.visible=t)}needsRedraw(r,t){const i=this.layers.get(r);return i?i.dirtyRegions.retrieve(t).length>0:!1}cleanup(){this.layers.clear()}},j=class{constructor(r){this.state=null,this.isVisible=!0,this.lastMovement=Date.now(),this.autoHideTimer=null,this.autoHideTimeout=r?.autoHideTimeout??3e3,this.startAutoHideTimer()}startAutoHideTimer(){this.autoHideTimer&&window.clearTimeout(this.autoHideTimer),this.autoHideTimer=window.setTimeout(()=>{Date.now()-this.lastMovement>=this.autoHideTimeout&&(this.isVisible=!1)},this.autoHideTimeout)}update(r,t){this.state&&this.state.position.x===r.x&&this.state.position.y===r.y||(this.state={position:r,isVisible:!0,content:{...t}},this.isVisible=!0,this.lastMovement=Date.now(),this.startAutoHideTimer())}getInvertedAttributes(r){return{foreground:15-r.foreground,background:15-r.background,blink:!1}}getCursorDisplay(){return!this.state||!this.isVisible?null:{position:this.state.position,isVisible:this.isVisible,content:{char:this.state.content.char,attributes:this.getInvertedAttributes(this.state.content.attributes)}}}getUnderlyingContent(){return this.state}setVisible(r){this.isVisible=r,r&&(this.lastMovement=Date.now(),this.startAutoHideTimer())}isCurrentlyVisible(){return this.isVisible&&this.state!==null}getCurrentPosition(){return this.state?.position||null}clear(){this.state=null,this.autoHideTimer&&(window.clearTimeout(this.autoHideTimer),this.autoHideTimer=null)}setAutoHideTimeout(r){this.autoHideTimeout=r,this.startAutoHideTimer()}handleKeyPress(){this.isVisible=!1,this.autoHideTimer&&(window.clearTimeout(this.autoHideTimer),this.autoHideTimer=null)}cleanup(){this.autoHideTimer&&(window.clearTimeout(this.autoHideTimer),this.autoHideTimer=null),this.state=null}};const R={system:{background:{foreground:"white",background:"#000080"},menuBar:{active:{foreground:"black",background:"#AAAAAA"},inactive:{foreground:"black",background:"#AAAAAA"}}},menuBar:{active:{foreground:"black",background:"#AAAAAA"},inactive:{foreground:"black",background:"#AAAAAA"}},window:{border:{active:{foreground:"yellow",background:"#AAAAAA"},inactive:{foreground:"gray",background:"#AAAAAA"}},background:{active:{foreground:"white",background:"#00AAAA"},inactive:{foreground:"gray",background:"#00AAAA"}},shadow:{foreground:"gray",background:"black"},scrollbar:{foreground:"white",background:"#000080"}},dialog:{border:{foreground:"white",background:"DarkMagenta"},background:{foreground:"white",background:"DarkMagenta"},button:{active:{foreground:"yellow",background:"DarkMagenta"},inactive:{foreground:"white",background:"DarkMagenta"}}},screen:{foreground:"white",background:"#000080"}},b={close:"■",maximize:"≡",resize:".",scrollUp:"▲",scrollDown:"▼",scrollLeft:"◄",scrollRight:"►"},Y={topLeft:"╔",topRight:"╗",bottomLeft:"╚",bottomRight:"╝",horizontal:"═",vertical:"║"},N={topLeft:" ",topRight:" ",bottomLeft:" ",bottomRight:" ",horizontal:" ",vertical:" "},D={black:0,blue:1,green:2,cyan:3,red:4,magenta:5,brown:6,lightgray:7,gray:8,darkgray:8,lightblue:9,lightgreen:10,lightcyan:11,lightred:12,lightmagenta:13,yellow:14,white:15,"#000000":0,"#0000AA":1,"#00AA00":2,"#00AAAA":3,"#AA0000":4,"#AA00AA":5,"#AA5500":6,"#AAAAAA":7,"#555555":8,"#5555FF":9,"#55FF55":10,"#55FFFF":11,"#FF5555":12,"#FF55FF":13,"#FFFF55":14,"#FFFFFF":15};function p(r){const t=r.toLowerCase().trim();if(t in D)return D[t];if(t.startsWith("#")){const i=parseInt(t.slice(1,3),16),e=parseInt(t.slice(3,5),16),s=parseInt(t.slice(5,7),16);let o=15,n=Number.MAX_VALUE;for(const[h,d]of Object.entries(D))if(h.startsWith("#")){const g=parseInt(h.slice(1,3),16),u=parseInt(h.slice(3,5),16),M=parseInt(h.slice(5,7),16),l=Math.sqrt(Math.pow(i-g,2)+Math.pow(e-u,2)+Math.pow(s-M,2));l<n&&(n=l,o=d)}return o}return 15}class X{constructor(t,i){this.isDirty=!0,this.animationFrameId=null,this.canvas=t,this.ctx=t.getContext("2d"),this.videoBuffer=i;const e=1.6;this.charWidth=Math.floor(t.width/i.getBufferData().width),this.charHeight=Math.floor(this.charWidth*e),this.canvas.height=this.charHeight*i.getBufferData().height,this.setupColorPalette()}setupColorPalette(){const t=["#000000","#0000AA","#00AA00","#00AAAA","#AA0000","#AA00AA","#AA5500","#AAAAAA","#555555","#5555FF","#55FF55","#55FFFF","#FF5555","#FF55FF","#FFFF55","#FFFFFF"],i=document.createElement("style");let e=`:root {
`;t.forEach((s,o)=>{e+=`  --color-${o}: ${s};
`}),e+="}",i.textContent=e,document.head.appendChild(i)}startRenderLoop(){const t=()=>{this.animationFrameId=requestAnimationFrame(t),this.isDirty&&(this.renderFrame(),this.isDirty=!1)};this.animationFrameId=requestAnimationFrame(t)}markDirty(){this.isDirty=!0,this.animationFrameId||this.startRenderLoop()}stopRenderLoop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}renderFrame(){const{width:t,height:i,cells:e}=this.videoBuffer.getBufferData();this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);for(let s=0;s<i;s++)for(let o=0;o<t;o++){const n=e[s][o]||{char:" ",attributes:{foreground:7,background:0,blink:!1}},h=getComputedStyle(document.documentElement).getPropertyValue(`--color-${n.attributes.background}`).trim();if(this.ctx.fillStyle=h,this.ctx.fillRect(o*this.charWidth,s*this.charHeight,this.charWidth,this.charHeight),n.char&&n.char.charCodeAt(0)>31){const d=getComputedStyle(document.documentElement).getPropertyValue(`--color-${n.attributes.foreground}`).trim();this.ctx.fillStyle=d;const g=Math.floor(this.charHeight*.8);this.ctx.font=`bold ${g}px monospace`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(n.char,o*this.charWidth+this.charWidth/2,s*this.charHeight+this.charHeight/2)}}}getCharacterDimensions(){return{width:this.charWidth,height:this.charHeight}}screenToBuffer(t,i){return{x:Math.floor(t*this.videoBuffer.getBufferData().width/this.canvas.width),y:Math.floor(i*this.videoBuffer.getBufferData().height/this.canvas.height)}}}class ${constructor(){this.cache=new Map}generateWindowHash(t){return JSON.stringify({position:t.position,size:t.size,title:t.title,isActive:t.isActive,isMaximized:t.isMaximized,scrollPosition:t.scrollPosition})}needsRedraw(t){const i=this.cache.get(t.id);return i?this.generateWindowHash(t)!==i.hash:!0}getContent(t){const i=this.cache.get(t);return i?i.content:null}update(t,i,e){this.cache.set(t.id,{id:t.id,content:i,region:e,lastUpdate:Date.now(),hash:this.generateWindowHash(t)})}remove(t){this.cache.delete(t)}getRegion(t){const i=this.cache.get(t);return i?i.region:null}regionsOverlap(t,i){return!(t.x+t.width<=i.x||i.x+i.width<=t.x||t.y+t.height<=i.y||i.y+i.height<=t.y)}getOverlappingWindows(t){const i=[];for(const[e,s]of this.cache.entries())this.regionsOverlap(t,s.region)&&i.push(e);return i}clear(){this.cache.clear()}getLastUpdate(t){const i=this.cache.get(t);return i?i.lastUpdate:0}isCached(t){return this.cache.has(t)}getCachedWindowIds(){return Array.from(this.cache.keys())}calculateCacheSize(){let t=0;for(const i of this.cache.values())t+=i.content.reduce((e,s)=>e+s.length*10,0);return t}cleanup(t){const i=Date.now();for(const[e,s]of this.cache.entries())i-s.lastUpdate>t&&this.cache.delete(e)}}class q{constructor(t,i,e){this.windows=[],this.activeWindow=null,this.onWindowCreated=null,this.onWindowClosed=null,this.onWindowUpdated=null,this.videoBuffer=t,this.theme=i,this.windowCache=new $,this.layerManager=e}convertColors(t){return{foreground:p(t.foreground),background:p(t.background)}}createSystemWindow(t){return this.windows.push(t),t.id}createWindow(t,i,e,s={}){const o=`window-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,n={id:o,title:t,position:i,size:e,isActive:!1,isMaximized:!1,isMinimized:!1,hasScrollbars:!1,scrollPosition:{x:0,y:0},borderless:s.borderless||!1,shadowless:s.shadowless||!1};return this.windows.push(n),this.setActiveWindow(o),this.onWindowCreated&&this.onWindowCreated(),o}createDialog(t,i,e,s){const o=`dialog-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,n={id:o,title:t,position:i,size:e,isActive:!1,isMaximized:!1,isMinimized:!1,hasScrollbars:!1,scrollPosition:{x:0,y:0},type:"dialog",buttons:s,selectedButton:0};return this.windows.push(n),this.setActiveWindow(o),o}setActiveWindow(t,i=!0){const e=this.windows.find(s=>s.id===t);if(e?.type!=="system"){if(this.activeWindow){const s=this.windows.find(o=>o.id===this.activeWindow);s&&(s.isActive=!1)}e&&(i&&(this.windows=this.windows.filter(s=>s.id!==t),this.windows.push(e)),e.isActive=!0,this.activeWindow=t,this.onWindowUpdated&&this.onWindowUpdated())}}writeChar(t,i,e,s){const o=this.videoBuffer.getBufferData();t>=0&&t<o.width&&i>=0&&i<o.height&&this.videoBuffer.writeChar(t,i,e,s)}getChar(t,i){try{return this.videoBuffer.getChar(t,i)}catch{return null}}drawShadow(t){const i=this.convertColors(this.theme.window.shadow),e=this.layerManager.createShadowRegion(t);for(let s=e.y;s<e.y+e.height;s++)for(let o=e.x;o<e.x+e.width;o++){const n=this.getChar(o,s);n&&this.writeChar(o,s,n.char,i)}}drawWindow(t){const{position:i,size:e,title:s,isActive:o,isMinimized:n}=t,h=t.type==="dialog",d=t.type==="system",g={x:i.x,y:i.y,width:e.width,height:e.height};if(!t.isMaximized&&!n&&!t.shadowless&&!d&&this.drawShadow(g),!this.windowCache.needsRedraw(t)){const l=this.windowCache.getContent(t.id);if(l){for(let a=0;a<l.length;a++)for(let c=0;c<l[a].length;c++){const w=l[a][c];w&&this.writeChar(i.x+c,i.y+a,w.char,w.attributes)}return}}const u=Array(e.height).fill(null).map(()=>Array(e.width).fill(null)),M=this.convertColors(d?t.role==="background"?this.theme.system.background:this.theme.system.menuBar.inactive:h?this.theme.dialog.background:o?this.theme.window.background.active:this.theme.window.background.inactive);if(!t.borderless){const l=h?Y:N,a=this.convertColors(h?this.theme.dialog.border:o?this.theme.window.border.active:this.theme.window.border.inactive);for(let c=0;c<e.width;c++)u[0][c]={char:l.horizontal,attributes:a},this.writeChar(i.x+c,i.y,l.horizontal,a),u[e.height-1][c]={char:l.horizontal,attributes:a},this.writeChar(i.x+c,i.y+e.height-1,l.horizontal,a);for(let c=1;c<e.height-1;c++)u[c][0]={char:l.vertical,attributes:a},this.writeChar(i.x,i.y+c,l.vertical,a),u[c][e.width-1]={char:l.vertical,attributes:a},this.writeChar(i.x+e.width-1,i.y+c,l.vertical,a);if(u[0][0]={char:l.topLeft,attributes:a},u[0][e.width-1]={char:l.topRight,attributes:a},u[e.height-1][0]={char:l.bottomLeft,attributes:a},u[e.height-1][e.width-1]={char:l.bottomRight,attributes:a},this.writeChar(i.x,i.y,l.topLeft,a),this.writeChar(i.x+e.width-1,i.y,l.topRight,a),this.writeChar(i.x,i.y+e.height-1,l.bottomLeft,a),this.writeChar(i.x+e.width-1,i.y+e.height-1,l.bottomRight,a),s){const c=Math.floor((e.width-s.length)/2);for(let w=0;w<s.length;w++)u[0][c+w]={char:s[w],attributes:a},this.writeChar(i.x+c+w,i.y,s[w],a)}o&&!h&&!d&&(u[0][0]={char:b.close,attributes:a},this.writeChar(i.x,i.y,b.close,a),u[0][e.width-1]={char:b.maximize,attributes:a},this.writeChar(i.x+e.width-1,i.y,b.maximize,a),n||(u[e.height-1][e.width-1]={char:b.resize,attributes:a},this.writeChar(i.x+e.width-1,i.y+e.height-1,b.resize,a)))}if(!n)for(let l=t.borderless?0:1;l<(t.borderless?e.height:e.height-1);l++)for(let a=t.borderless?0:1;a<(t.borderless?e.width:e.width-1);a++)u[l][a]={char:" ",attributes:M},this.writeChar(i.x+a,i.y+l," ",M);if(h){const l=t;if(l.buttons.length>0){const a=e.height-2;let c=Math.floor((e.width-l.buttons.join("  ").length)/2);l.buttons.forEach((w,L)=>{const O=L===l.selectedButton,B=this.convertColors(O?this.theme.dialog.button.active:this.theme.dialog.button.inactive);for(let m=0;m<w.length;m++)u[a][c+m]={char:w[m],attributes:B},this.writeChar(i.x+c+m,i.y+a,w[m],B);c+=w.length+2})}}this.windowCache.update(t,u,g)}draw(){const t=new Set(this.windows.map(i=>i.id));this.windowCache.getCachedWindowIds().forEach(i=>{t.has(i)||this.windowCache.remove(i)}),this.windows.forEach(i=>{this.drawWindow(i)}),this.windowCache.cleanup(5e3)}closeWindow(t){const i=this.windows.find(s=>s.id===t);if(!i||i.type==="system")return;const e=this.windows.findIndex(s=>s.id===t);if(e!==-1){const{position:s,size:o}=i,n={x:s.x,y:s.y,width:o.width,height:o.height};if(this.layerManager.markWindowAndShadowDirty(n),this.windowCache.remove(t),this.windows.splice(e,1),this.onWindowClosed&&this.onWindowClosed(),this.activeWindow===t){const h=[...this.windows].reverse().find(d=>d.type!=="system");if(this.activeWindow=h?h.id:null,this.activeWindow){const d=this.windows.find(g=>g.id===this.activeWindow);if(d){const g={x:d.position.x,y:d.position.y,width:d.size.width,height:d.size.height};this.layerManager.markWindowAndShadowDirty(g),this.windowCache.remove(this.activeWindow)}}}this.windows.forEach(h=>{const d={x:h.position.x,y:h.position.y,width:h.size.width,height:h.size.height};this.regionsIntersect(n,d)&&(this.layerManager.markWindowAndShadowDirty(d),this.windowCache.remove(h.id))})}}regionsIntersect(t,i){return!(i.x>=t.x+t.width||i.x+i.width<=t.x||i.y>=t.y+t.height||i.y+i.height<=t.y)}updateWindowPosition(t,i){const e=this.windows.find(s=>s.id===t);if(e){const s={x:e.position.x,y:e.position.y,width:e.size.width,height:e.size.height};this.layerManager.markWindowAndShadowDirty(s),e.position=i;const o={x:i.x,y:i.y,width:e.size.width,height:e.size.height};this.layerManager.markWindowAndShadowDirty(o),this.windowCache.remove(t),this.onWindowUpdated&&this.onWindowUpdated()}}updateWindowSize(t,i){const e=this.windows.find(s=>s.id===t);if(e){const s={x:e.position.x,y:e.position.y,width:e.size.width,height:e.size.height};this.layerManager.markWindowAndShadowDirty(s),e.size=i;const o={x:e.position.x,y:e.position.y,width:i.width,height:i.height};this.layerManager.markWindowAndShadowDirty(o),this.windowCache.remove(t),this.onWindowUpdated&&this.onWindowUpdated()}}toggleMinimize(t){const i=this.windows.find(s=>s.id===t);if(!i||i.type)return;const e={x:i.position.x,y:i.position.y,width:i.size.width,height:i.size.height};this.layerManager.markWindowAndShadowDirty(e),i.isMinimized?i.originalSize&&(i.size={...i.originalSize}):(i.originalSize={...i.size},i.size={width:i.size.width,height:1}),i.isMinimized=!i.isMinimized,this.windowCache.remove(t)}toggleMaximize(t){const i=this.windows.find(h=>h.id===t);if(!i||i.type)return;const{position:e,size:s,isMaximized:o}=i,n={x:e.x,y:e.y,width:s.width,height:s.height};if(this.layerManager.markWindowAndShadowDirty(n),i.isMaximized=!o,i.isMaximized){i.originalSize={...s},i.position={x:0,y:1},i.size={width:this.videoBuffer.getBufferData().width,height:this.videoBuffer.getBufferData().height-1};const h={x:0,y:1,width:i.size.width,height:i.size.height};this.layerManager.markWindowAndShadowDirty(h)}else i.originalSize&&(i.size={...i.originalSize},i.position={x:Math.floor((this.videoBuffer.getBufferData().width-i.size.width)/2),y:Math.floor((this.videoBuffer.getBufferData().height-i.size.height)/2)});this.windowCache.remove(t)}getWindows(){return[...this.windows]}getActiveWindow(){return this.windows.find(t=>t.id===this.activeWindow)||null}}var C=(r=>(r.Background="background",r.Shadow="shadow",r.Window="window",r.Cursor="cursor",r))(C||{});const I={x:2,y:1};class G extends H{constructor(t,i){super(t,{width:t.getBufferData().width,height:t.getBufferData().height,maxDepth:4,maxObjects:10}),this.theme=i,this.layerIds={background:"background",shadow:"shadow",window:"window",cursor:"cursor"},this.initializeLayers()}registerFoxProLayer(t){super.registerLayer(t)}initializeLayers(){this.registerFoxProLayer({id:this.layerIds.background,type:"background",zIndex:0,visible:!0}),this.registerFoxProLayer({id:this.layerIds.shadow,type:"shadow",zIndex:1,visible:!0}),this.registerFoxProLayer({id:this.layerIds.window,type:"window",zIndex:2,visible:!0}),this.registerFoxProLayer({id:this.layerIds.cursor,type:"cursor",zIndex:3,visible:!0})}convertColors(t){return{foreground:p(t.foreground),background:p(t.background)}}createShadowRegion(t){return{x:t.x+I.x,y:t.y+I.y,width:t.width,height:t.height}}markWindowAndShadowDirty(t){this.markDirty(this.layerIds.window,t);const i=this.createShadowRegion(t);this.markDirty(this.layerIds.shadow,i),this.markDirty(this.layerIds.background,t),this.markDirty(this.layerIds.background,i)}clearBackground(){this.clearDirtyRegions(this.layerIds.background)}regionsIntersect(t,i){return!(i.x>=t.x+t.width||i.x+i.width<=t.x||i.y>=t.y+t.height||i.y+i.height<=t.y)}draw(){const t=Array.from(this.layers.values()).sort((i,e)=>i.zIndex-e.zIndex);for(const i of t)if(i.visible)switch(i.type){case"background":this.clearBackground();break;case"shadow":case"window":break;case"cursor":this.getDirtyRegions(this.layerIds.cursor).forEach(s=>{const o=this.getVisibleRegion(s);o&&(this.getDirtyRegions(this.layerIds.window).some(h=>this.regionsIntersect(o,h))||this.markDirty(this.layerIds.background,o))}),this.clearDirtyRegions(this.layerIds.cursor);break}}updateTheme(t){this.theme=t,this.markDirty(this.layerIds.background,{x:0,y:0,width:this.bufferSize.width,height:this.bufferSize.height})}}class Q{constructor(t,i,e,s,o=R){this.unsubscribe=null,this.backgroundWindowId=null,this.menuBarWindowId=null,this.dragState=null,this.resizeState=null,this.lastClickTime=0,this.lastClickWindow=null,this.lastCursorVisible=!0,this.videoBuffer=t,this.keyboard=i,this.mouse=e,this.theme=o,this.screenSize={width:t.getBufferData().width,height:t.getBufferData().height},this.workspaceSize={width:this.screenSize.width,height:this.screenSize.height-1},this.renderer=new X(s,t),this.layerManager=new G(t,o),this._windowManager=new q(t,o,this.layerManager),this._windowManager.onWindowCreated=()=>this.markDirty(),this._windowManager.onWindowClosed=()=>this.markDirty(),this._windowManager.onWindowUpdated=()=>this.markDirty(),this.cursorManager=new j({autoHideTimeout:3e3}),this.initializeScreen(),this.setupEventHandlers(),this.startRenderLoop()}get windowManager(){return this._windowManager}initializeScreen(){const t={id:`window-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"system",role:"background",title:"",position:{x:-1,y:0},size:{width:this.screenSize.width+2,height:this.screenSize.height+1},isActive:!1,isMaximized:!1,isMinimized:!1,hasScrollbars:!1,scrollPosition:{x:0,y:0},borderless:!0,shadowless:!0};if(this.backgroundWindowId=this._windowManager.createSystemWindow(t),this.backgroundWindowId)for(let e=0;e<this.screenSize.height;e++)for(let s=-1;s<this.screenSize.width+1;s++)this.writeChar(s,e," ",this.theme.system.background);const i={id:`window-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"system",role:"menubar",title:"",position:{x:0,y:0},size:{width:this.screenSize.width,height:1},isActive:!1,isMaximized:!1,isMinimized:!1,hasScrollbars:!1,scrollPosition:{x:0,y:0},borderless:!0,shadowless:!0};if(this.menuBarWindowId=this._windowManager.createSystemWindow(i),this.menuBarWindowId){for(let o=0;o<this.screenSize.width;o++)this.writeChar(o,0," ",this.theme.menuBar.inactive);const e=[" System "," File "," Edit "," Database "," Record "," Program "," Window "];let s=0;e.forEach(o=>{this.renderText(s,0,[o],this.theme.menuBar.inactive),s+=o.length})}}setupEventHandlers(){this.unsubscribe=y.subscribe(t=>{if(t.source==="mouse"&&"position"in t.data){const{position:i,modifiers:e,isButtonDown:s}=t.data,o=this.videoBuffer.getChar(i.x,i.y);o&&(this.cursorManager.clear(),this.cursorManager.update(i,o),this.cursorManager.setVisible(!0),this.layerManager.markDirty(this.layerManager.layerIds[C.Cursor],{x:i.x,y:i.y,width:1,height:1}));let n=!0;switch(t.type){case f.MOUSE_MOVE:case f.MOUSE_DRAG:this.handleMouseMove(i);break;case f.MOUSE_DOWN:console.log("Mouse down at:",i);const h=this.windowManager.getWindows();let d=!1;for(let g=h.length-1;g>=0;g--){const u=h[g];if(this.isPointInWindow(i,u)){this.handleMouseClick(i,0,e),d=!0,n=!0;break}}!d&&i.y===0&&(this.handleMouseClick(i,0,e),n=!0);break;case f.MOUSE_UP:(this.dragState||this.resizeState)&&(this.handleMouseUp(),n=!0);break;case f.MOUSE_DOUBLE_CLICK:this.handleDoubleClick(i),n=!0;break}n&&this.markDirty()}else if(t.source==="keyboard"&&t.type===f.KEY_DOWN){const{key:i,modifiers:e}=t.data;this.handleKeyPress(i,e),this.cursorManager.handleKeyPress()}},{eventTypes:[f.MOUSE_MOVE,f.MOUSE_DOWN,f.MOUSE_UP,f.MOUSE_DRAG,f.MOUSE_DOUBLE_CLICK,f.KEY_DOWN],minPriority:100})}convertColors(t){return{foreground:p(t.foreground),background:p(t.background)}}writeChar(t,i,e,s){t>=this.screenSize.width||i<0||i>=this.screenSize.height||this.videoBuffer.writeChar(t,i,e,this.convertColors(s))}handleMouseMove(t){if(this.dragState){const i=t.x-this.dragState.startPos.x,e=t.y-this.dragState.startPos.y;this.windowManager.updateWindowPosition(this.dragState.windowId,{x:this.dragState.offset.x+i,y:Math.max(1,this.dragState.offset.y+e)})}if(this.resizeState){const i=t.x-this.resizeState.startPos.x,e=t.y-this.resizeState.startPos.y,s=Math.max(20,this.resizeState.startSize.width+i),o=Math.max(10,this.resizeState.startSize.height+e);this.windowManager.updateWindowSize(this.resizeState.windowId,{width:s,height:o})}if(t.y===0&&this.menuBarWindowId){let i=0;const e=[" System "," File "," Edit "," Database "," Record "," Program "," Window "];let s=!1;for(const o of e)t.x>=i&&t.x<i+o.length?(this.renderText(i,0,[o],this.theme.menuBar.active),s=!0):this.renderText(i,0,[o],this.theme.menuBar.inactive),i+=o.length;if(!s){let o=0;e.forEach(n=>{this.renderText(o,0,[n],this.theme.menuBar.inactive),o+=n.length})}}this.markDirty()}drawMouseCursor(){const t=this.mouse.getState();if(!t.position||!t.isVisible)return;const i=this.cursorManager.getCursorDisplay();i&&(this.videoBuffer.writeChar(i.position.x,i.position.y,i.content.char,i.content.attributes),this.layerManager.markDirty(this.layerManager.layerIds[C.Cursor],{x:i.position.x,y:i.position.y,width:1,height:1}))}handleDoubleClick(t){const i=this.windowManager.getWindows();for(let e=i.length-1;e>=0;e--){const s=i[e];if(this.isPointInWindow(t,s)&&s.isActive&&t.y===s.position.y){this.windowManager.toggleMinimize(s.id),this.markDirty();return}}}handleMouseClick(t,i,e){const s=this.windowManager.getWindows();if(!(this.dragState||this.resizeState)){if(t.y===0&&this.menuBarWindowId){let o=0;const n=[" System "," File "," Edit "," Database "," Record "," Program "," Window "];for(const h of n){if(t.x>=o&&t.x<o+h.length){this.renderText(o,0,[h],this.theme.menuBar.active);return}o+=h.length}return}for(let o=s.length-1;o>=0;o--){const n=s[o];if(!(n.id===this.backgroundWindowId||n.id===this.menuBarWindowId)&&this.isPointInWindow(t,n)){const h=n.isActive,d=!!e?.shift;if(t.y===n.position.y){const g=t.x>n.position.x&&t.x<n.position.x+n.size.width-1;if(!h&&d&&g){this.dragState={windowId:n.id,startPos:t,offset:{x:n.position.x,y:n.position.y}};return}if(!h&&!d&&(this.windowManager.setActiveWindow(n.id,!0),g&&(this.dragState={windowId:n.id,startPos:t,offset:{x:n.position.x,y:n.position.y}})),h){if(t.x===n.position.x){this.windowManager.closeWindow(n.id),this.markDirty();return}if(t.x===n.position.x+n.size.width-1){this.windowManager.toggleMaximize(n.id),this.markDirty();return}g&&(this.dragState={windowId:n.id,startPos:t,offset:{x:n.position.x,y:n.position.y}})}}if(h&&t.x===n.position.x+n.size.width-1&&t.y===n.position.y+n.size.height-1){this.resizeState={windowId:n.id,startPos:t,startSize:{...n.size}};return}!h&&!d&&!this.dragState&&this.windowManager.setActiveWindow(n.id,!0);break}}this.lastClickWindow=null,this.lastClickTime=0}}handleMouseUp(){if(this.dragState=null,this.resizeState=null,this.menuBarWindowId){let t=0;[" System "," File "," Edit "," Database "," Record "," Program "," Window "].forEach(e=>{this.renderText(t,0,[e],this.theme.menuBar.inactive),t+=e.length})}this.markDirty(),this.lastClickWindow=null,this.lastClickTime=0}isPointInWindow(t,i){return t.x>=i.position.x&&t.x<i.position.x+i.size.width&&t.y>=i.position.y&&t.y<i.position.y+i.size.height}handleKeyPress(t,i){}fillBackground(){if(this.backgroundWindowId){for(let t=0;t<this.screenSize.height;t++)for(let i=-1;i<this.screenSize.width+1;i++)this.writeChar(i,t," ",this.theme.screen);this.markDirty()}}updateScreenSize(t,i){this.screenSize={width:t,height:i},this.workspaceSize={width:t,height:i-1},this.backgroundWindowId&&(this._windowManager.updateWindowPosition(this.backgroundWindowId,{x:-1,y:0}),this._windowManager.updateWindowSize(this.backgroundWindowId,{width:this.screenSize.width+2,height:this.screenSize.height+1}),this.fillBackground()),this.menuBarWindowId&&this._windowManager.updateWindowSize(this.menuBarWindowId,{width:this.screenSize.width,height:1})}getScreenSize(){return{...this.screenSize}}getWorkspaceSize(){return{...this.workspaceSize}}setTheme(t){this.theme=t,this.layerManager.updateTheme(t),this.initializeScreen()}getTheme(){return this.theme}update(){this.videoBuffer.beginBatch(),this.layerManager.draw(),this.windowManager.draw(),this.drawMouseCursor(),this.videoBuffer.endBatch(),this.videoBuffer.flush()}startRenderLoop(){this.renderer.startRenderLoop();const t=()=>{const e=this.mouse.getState().isVisible&&this.cursorManager.isCurrentlyVisible();e!==this.lastCursorVisible&&(this.update(),this.renderer.markDirty(),this.lastCursorVisible=e),requestAnimationFrame(t)};requestAnimationFrame(t)}markDirty(){this.update(),this.renderer.markDirty()}getRenderer(){return this.renderer}renderText(t,i,e,s){const o=s||this.theme.screen;e.forEach((n,h)=>{for(let d=0;d<n.length;d++)this.writeChar(t+d,i+h,n[d],o)}),this.markDirty()}cleanup(){this.cursorManager.cleanup(),this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null),this.renderer&&this.renderer.stopRenderLoop()}}const A=document.getElementById("screen");A.width=1600;const J=new T(80,25),v=new K,z=new _(A);v.initialize();z.initialize();const W=new Q(J,v,z,A,R);document.addEventListener("keydown",r=>{if(r.key==="n"||r.key==="N"){const t=Math.floor(Math.random()*40),i=Math.floor(Math.random()*15)+5;W.windowManager.createWindow("New Window",{x:t,y:i},{width:30,height:10})}});window.addEventListener("unload",()=>{v.cleanup(),z.cleanup()});W.windowManager.createWindow("Welcome to FoxPro UI",{x:5,y:5},{width:40,height:15});const Z=["FoxPro UI Demo","","Press N to create new windows","","Window Controls:","  • Click title to focus","  • Drag title to move","  • Click × to close","  • Click ≡ to maximize","  • Drag . to resize"];W.renderText(7,6,Z);
