(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function i(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=i(r);fetch(r.href,o)}})();var f=(e=>(e.MOUSE_MOVE="MOUSE_MOVE",e.MOUSE_DOWN="MOUSE_DOWN",e.MOUSE_UP="MOUSE_UP",e.MOUSE_DRAG="MOUSE_DRAG",e.MOUSE_DOUBLE_CLICK="MOUSE_DOUBLE_CLICK",e.KEY_DOWN="KEY_DOWN",e.KEY_UP="KEY_UP",e))(f||{});function T(e,t){return!(e.x+e.width<=t.x||t.x+t.width<=e.x||e.y+e.height<=t.y||t.y+t.height<=e.y)}function F(e,t){const i=Math.min(e.x,t.x),s=Math.min(e.y,t.y),r=Math.max(e.x+e.width,t.x+t.width),o=Math.max(e.y+e.height,t.y+t.height);return{x:i,y:s,width:r-i,height:o-s}}function _(e,t){const i=e.y===t.y&&e.height===t.height&&(e.x+e.width===t.x||t.x+t.width===e.x),s=e.x===t.x&&e.width===t.width&&(e.y+e.height===t.y||t.y+t.height===e.y);return i||s}var K=class{constructor(e=80,t=25){this.width=e,this.height=t,this.buffer=Array(t).fill(null).map(()=>Array(e).fill(null)),this.cursor={x:0,y:0,visible:!0,blinking:!0},this.dirtyRegions=[],this.batchRegions=[],this.batchMode=!1}writeChar(e,t,i,s){if(e<0||e>=this.width||t<0||t>=this.height)return;const r={char:i[0],attributes:s};this.buffer[t][e]=r,this.markDirty(e,t,1,1)}getChar(e,t){return e<0||e>=this.width||t<0||t>=this.height?null:this.buffer[t][e]}resize(e,t){const i=Array(t).fill(null).map(()=>Array(e).fill(null));for(let s=0;s<Math.min(t,this.height);s++)for(let r=0;r<Math.min(e,this.width);r++)i[s][r]=this.buffer[s][r];this.width=e,this.height=t,this.buffer=i,this.markDirty(0,0,e,t),this.cursor.x=Math.min(this.cursor.x,e-1),this.cursor.y=Math.min(this.cursor.y,t-1)}clear(){for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++)this.buffer[e][t]!==null&&this.markDirty(t,e,1,1);this.buffer=Array(this.height).fill(null).map(()=>Array(this.width).fill(null))}setCursorPosition(e,t){e<0||e>=this.width||t<0||t>=this.height||(this.markDirty(this.cursor.x,this.cursor.y,1,1),this.markDirty(e,t,1,1),this.cursor.x=e,this.cursor.y=t)}getCursorPosition(){return{x:this.cursor.x,y:this.cursor.y}}setCursorVisible(e){this.cursor.visible!==e&&(this.cursor.visible=e,this.markDirty(this.cursor.x,this.cursor.y,1,1))}setCursorBlinking(e){this.cursor.blinking!==e&&(this.cursor.blinking=e,this.markDirty(this.cursor.x,this.cursor.y,1,1))}beginBatch(){this.batchMode=!0,this.batchRegions=[]}endBatch(){this.batchMode=!1,this.batchRegions.length>0&&(this.optimizeAndAddRegions(this.batchRegions),this.batchRegions=[])}flush(){const e=[...this.dirtyRegions];return this.dirtyRegions=[],e}getBufferData(){if(this.cursor.visible&&this.cursor.blinking){const e=performance.now();(!this.cursor.lastBlinkTime||Math.floor(this.cursor.lastBlinkTime/500)!==Math.floor(e/500))&&(this.markDirty(this.cursor.x,this.cursor.y,1,1),this.cursor.lastBlinkTime=e)}return{width:this.width,height:this.height,cells:this.buffer,cursor:{...this.cursor}}}getDirtyRegions(){const e=[...this.dirtyRegions];return this.dirtyRegions=[],e}markDirty(e,t,i,s){const r={x:e,y:t,width:i,height:s};this.batchMode?this.batchRegions.push(r):this.optimizeAndAddRegions([r])}optimizeAndAddRegions(e){let t=[...this.dirtyRegions,...e],i=[],s;do{for(s=!1;t.length>0;){const r=t.pop();let o=!1;for(let n=0;n<i.length;n++)if(T(r,i[n])||_(r,i[n])){i[n]=F(r,i[n]),o=!0,s=!0;break}o||i.push(r)}s&&(t=i,i=[])}while(s);this.dirtyRegions=i}},V=class{constructor(){this.handlers=new Map,this.priorityThresholds=new Map}subscribe(e,t={}){const{eventTypes:i,minPriority:s=0}=t,r=i||["*"];return r.forEach(o=>{this.handlers.has(o)||this.handlers.set(o,new Set),this.handlers.get(o).add(e),s>0&&this.priorityThresholds.set(o,s)}),()=>{r.forEach(o=>{const n=this.handlers.get(o);n&&(n.delete(e),n.size===0&&(this.handlers.delete(o),this.priorityThresholds.delete(o)))})}}publish(e){e.timestamp||(e.timestamp=Date.now());const t=this.priorityThresholds.get(e.type)||0;if(e.priority>=t){const i=this.handlers.get(e.type);i&&i.forEach(r=>r(e));const s=this.handlers.get("*");s&&s.forEach(r=>r(e))}}clear(){this.handlers.clear(),this.priorityThresholds.clear()}},y=new V,H=class{constructor(){this.state={lastKeyPressed:null,modifiers:{ctrl:!1,alt:!1,shift:!1,meta:!1}},this.listeners=new Set,this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this)}initialize(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}cleanup(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)}handleKeyDown(e){this.state.modifiers={ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey,meta:e.metaKey},this.state.lastKeyPressed=e.key;const t={type:"KEY_DOWN",timestamp:Date.now(),priority:100,source:"keyboard",data:{key:e.key,modifiers:this.state.modifiers}};y.publish(t),this.notifyListeners()}handleKeyUp(e){this.state.modifiers={ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey,meta:e.metaKey},this.state.lastKeyPressed===e.key&&(this.state.lastKeyPressed=null);const t={type:"KEY_UP",timestamp:Date.now(),priority:100,source:"keyboard",data:{key:e.key,modifiers:this.state.modifiers}};y.publish(t),this.notifyListeners()}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}notifyListeners(){this.listeners.forEach(e=>e(this.state))}getState(){return{...this.state}}},D=class{constructor(e,t){this.keyboardService=t,this.element=e,this.state={position:null,isVisible:!1,isButtonDown:!1,modifiers:{ctrl:!1,alt:!1,shift:!1,meta:!1}},this.listeners=new Set,this.lastPosition=null,this.lastClickTime=0,this.lastClickPosition=null,this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),this.handleMouseEnter=this.handleMouseEnter.bind(this)}initialize(){this.element.addEventListener("mousemove",this.handleMouseMove),this.element.addEventListener("mousedown",this.handleMouseDown),this.element.addEventListener("mouseup",this.handleMouseUp),this.element.addEventListener("mouseleave",this.handleMouseLeave),this.element.addEventListener("mouseenter",this.handleMouseEnter)}cleanup(){this.element.removeEventListener("mousemove",this.handleMouseMove),this.element.removeEventListener("mousedown",this.handleMouseDown),this.element.removeEventListener("mouseup",this.handleMouseUp),this.element.removeEventListener("mouseleave",this.handleMouseLeave),this.element.removeEventListener("mouseenter",this.handleMouseEnter)}handleMouseEnter(e){const t=this.screenToBuffer(e.clientX,e.clientY);this.state.position=t,this.lastPosition={...t},this.state.isVisible=!0,this.state.modifiers={ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey,meta:e.metaKey};const i={type:"MOUSE_MOVE",timestamp:Date.now(),priority:100,source:"mouse",data:{position:t,isButtonDown:this.state.isButtonDown,modifiers:this.state.modifiers,isVisible:this.state.isVisible}};y.publish(i),this.notifyListeners()}handleMouseLeave(e){const t=this.lastPosition?{...this.lastPosition}:null;if(this.state.isVisible=!1,this.state.position=null,this.lastPosition=null,this.state.isButtonDown=!1,t){const i={type:"MOUSE_MOVE",timestamp:Date.now(),priority:100,source:"mouse",data:{position:t,isButtonDown:!1,modifiers:this.state.modifiers,isVisible:!1}};y.publish(i)}this.notifyListeners()}screenToBuffer(e,t){const s=this.element.getBoundingClientRect(),r=e-s.left,o=t-s.top,n=s.width/80,h=s.height/25,l=Math.floor(r/n),u=Math.floor(o/h);return{x:Math.max(0,Math.min(l,79)),y:Math.max(0,Math.min(u,24))}}hasPositionChanged(e,t){return e?e.x!==t.x||e.y!==t.y:!0}handleMouseMove(e){const t=this.element.getBoundingClientRect(),i=e.clientX-t.left,s=e.clientY-t.top;if(i<0||i>=t.width||s<0||s>=t.height){const o=this.lastPosition?{...this.lastPosition}:null;if(this.state.isVisible=!1,this.state.position=null,this.lastPosition=null,this.state.isButtonDown=!1,o){const n={type:"MOUSE_MOVE",timestamp:Date.now(),priority:100,source:"mouse",data:{position:o,isButtonDown:!1,modifiers:this.state.modifiers,isVisible:!1}};y.publish(n)}this.notifyListeners();return}const r=this.screenToBuffer(e.clientX,e.clientY);if(this.hasPositionChanged(this.state.position,r)){this.state.isVisible||(this.state.isVisible=!0),this.state.position=r,this.lastPosition={...r},this.state.modifiers={ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey,meta:e.metaKey};const o={type:this.state.isButtonDown?"MOUSE_DRAG":"MOUSE_MOVE",timestamp:Date.now(),priority:100,source:"mouse",data:{position:r,isButtonDown:this.state.isButtonDown,modifiers:this.state.modifiers,isVisible:this.state.isVisible}};y.publish(o),this.notifyListeners()}}isWithinDoubleClickDistance(e,t){const i=Math.abs(e.x-t.x),s=Math.abs(e.y-t.y);return i<=D.DOUBLE_CLICK_DISTANCE&&s<=D.DOUBLE_CLICK_DISTANCE}handleMouseDown(e){const t=this.element.getBoundingClientRect(),i=e.clientX-t.left,s=e.clientY-t.top;if(i>=0&&i<t.width&&s>=0&&s<t.height){const r=this.screenToBuffer(e.clientX,e.clientY),o=Date.now();this.state.position=r,this.lastPosition={...r},this.state.isButtonDown=!0,this.state.isVisible=!0,this.state.modifiers={ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey,meta:e.metaKey};const n={type:"MOUSE_DOWN",timestamp:o,priority:100,source:"mouse",data:{position:r,isButtonDown:!0,modifiers:this.state.modifiers,isVisible:this.state.isVisible}};if(y.publish(n),this.lastClickPosition&&o-this.lastClickTime<=D.DOUBLE_CLICK_TIMEOUT&&this.isWithinDoubleClickDistance(r,this.lastClickPosition)){const h={type:"MOUSE_DOUBLE_CLICK",timestamp:o,priority:100,source:"mouse",data:{position:r,isButtonDown:!0,modifiers:{ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey,meta:e.metaKey},isVisible:!0}};y.publish(h),this.lastClickTime=0,this.lastClickPosition=null}else this.lastClickTime=o,this.lastClickPosition={...r};this.notifyListeners()}}handleMouseUp(e){const t=this.screenToBuffer(e.clientX,e.clientY),i=this.isInBounds(e.clientX,e.clientY);if(this.state.isButtonDown=!1,i&&(this.state.position=t,this.lastPosition={...t},this.state.isVisible=!0),this.state.modifiers={ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey,meta:e.metaKey},i){const s={type:"MOUSE_UP",timestamp:Date.now(),priority:100,source:"mouse",data:{position:t,isButtonDown:!1,modifiers:this.state.modifiers,isVisible:this.state.isVisible}};y.publish(s)}this.notifyListeners()}isInBounds(e,t){const i=this.element.getBoundingClientRect(),s=e-i.left,r=t-i.top;return s>=0&&s<i.width&&r>=0&&r<i.height}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}notifyListeners(){this.listeners.forEach(e=>e(this.state))}getState(){return{...this.state}}},A=D;A.DOUBLE_CLICK_TIMEOUT=500;A.DOUBLE_CLICK_DISTANCE=1;var x=class{constructor(e,t=4,i=10,s=0){this.objects=[],this.nodes=[],this.bounds=e,this.maxDepth=t,this.maxObjects=i,this.depth=s}clear(){this.objects=[],this.nodes.forEach(e=>e.clear()),this.nodes=[]}split(){const e=this.bounds.width/2,t=this.bounds.height/2,i=this.bounds.x,s=this.bounds.y;this.nodes=[new x({x:i+e,y:s,width:e,height:t},this.maxDepth,this.maxObjects,this.depth+1),new x({x:i,y:s,width:e,height:t},this.maxDepth,this.maxObjects,this.depth+1),new x({x:i,y:s+t,width:e,height:t},this.maxDepth,this.maxObjects,this.depth+1),new x({x:i+e,y:s+t,width:e,height:t},this.maxDepth,this.maxObjects,this.depth+1)]}getIndex(e){const t=this.bounds.x+this.bounds.width/2,i=this.bounds.y+this.bounds.height/2,s=e.y<i&&e.y+e.height<i,r=e.y>i;if(e.x<t&&e.x+e.width<t){if(s)return 1;if(r)return 2}else if(e.x>t){if(s)return 0;if(r)return 3}return-1}insert(e){if(this.nodes.length>0){const t=this.getIndex(e);if(t!==-1){this.nodes[t].insert(e);return}}if(this.objects.push(e),this.objects.length>this.maxObjects&&this.depth<this.maxDepth){this.nodes.length===0&&this.split();let t=0;for(;t<this.objects.length;){const i=this.getIndex(this.objects[t]);if(i!==-1){const s=this.objects.splice(t,1)[0];this.nodes[i].insert(s)}else t++}}}retrieve(e){const t=this.getIndex(e);let i=this.objects;if(this.nodes.length>0)if(t!==-1)i=i.concat(this.nodes[t].retrieve(e));else for(const s of this.nodes)i=i.concat(s.retrieve(e));return i}mergeRegions(){const e=this.getAllRegions(),t=[];for(;e.length>0;){let i=e.pop(),s=!0;for(;s;){s=!1;for(let r=e.length-1;r>=0;r--){const o=e[r];this.canMergeRegions(i,o)&&(i=this.mergeRegion(i,o),e.splice(r,1),s=!0)}}t.push(i)}return t}getAllRegions(){let e=[...this.objects];for(const t of this.nodes)e=e.concat(t.getAllRegions());return e}canMergeRegions(e,t){return!(e.x+e.width<t.x||t.x+t.width<e.x||e.y+e.height<t.y||t.y+t.height<e.y)}mergeRegion(e,t){const i=Math.min(e.x,t.x),s=Math.min(e.y,t.y),r=Math.max(e.x+e.width,t.x+t.width)-i,o=Math.max(e.y+e.height,t.y+t.height)-s;return{x:i,y:s,width:r,height:o}}},j=class{constructor(e,t){this.videoBuffer=e,this.bufferSize={width:t.width,height:t.height},this.maxDepth=t.maxDepth||4,this.maxObjects=t.maxObjects||10,this.layers=new Map}registerLayer(e){this.layers.set(e.id,{...e,dirtyRegions:new x({x:0,y:0,width:this.bufferSize.width,height:this.bufferSize.height},this.maxDepth,this.maxObjects)})}markDirty(e,t){const i=this.layers.get(e);i&&i.dirtyRegions.insert(t)}isInBounds(e,t){return e>=0&&e<this.bufferSize.width&&t>=0&&t<this.bufferSize.height}getVisibleRegion(e){const t=Math.max(0,e.x),i=Math.max(0,e.y),s=Math.min(e.x+e.width,this.bufferSize.width),r=Math.min(e.y+e.height,this.bufferSize.height);return s<=t||r<=i?null:{x:t,y:i,width:s-t,height:r-i}}writeContent(e,t,i){this.isInBounds(e,t)&&this.videoBuffer.writeChar(e,t,i.char,i.attributes)}getDirtyRegions(e){const t=this.layers.get(e);return t?t.dirtyRegions.mergeRegions():[]}clearDirtyRegions(e){const t=this.layers.get(e);t&&t.dirtyRegions.clear()}setLayerVisibility(e,t){const i=this.layers.get(e);i&&(i.visible=t)}needsRedraw(e,t){const i=this.layers.get(e);return i?i.dirtyRegions.retrieve(t).length>0:!1}cleanup(){this.layers.clear()}},Y=class{constructor(e){this.state=null,this.isVisible=!0,this.lastMovement=Date.now(),this.autoHideTimer=null,this.autoHideTimeout=e?.autoHideTimeout??3e3,this.startAutoHideTimer()}startAutoHideTimer(){this.autoHideTimer&&window.clearTimeout(this.autoHideTimer),this.autoHideTimer=window.setTimeout(()=>{Date.now()-this.lastMovement>=this.autoHideTimeout&&(this.isVisible=!1)},this.autoHideTimeout)}update(e,t){this.state&&this.state.position.x===e.x&&this.state.position.y===e.y||(this.state={position:e,isVisible:!0,content:{...t}},this.isVisible=!0,this.lastMovement=Date.now(),this.startAutoHideTimer())}getInvertedAttributes(e){return{foreground:15-e.foreground,background:15-e.background,blink:!1}}getCursorDisplay(){return!this.state||!this.isVisible?null:{position:this.state.position,isVisible:this.isVisible,content:{char:this.state.content.char,attributes:this.getInvertedAttributes(this.state.content.attributes)}}}getUnderlyingContent(){return this.state}setVisible(e){this.isVisible=e,e&&(this.lastMovement=Date.now(),this.startAutoHideTimer())}isCurrentlyVisible(){return this.isVisible&&this.state!==null}getCurrentPosition(){return this.state?.position||null}clear(){this.state=null,this.autoHideTimer&&(window.clearTimeout(this.autoHideTimer),this.autoHideTimer=null)}setAutoHideTimeout(e){this.autoHideTimeout=e,this.startAutoHideTimer()}handleKeyPress(){this.isVisible=!1,this.autoHideTimer&&(window.clearTimeout(this.autoHideTimer),this.autoHideTimer=null)}cleanup(){this.autoHideTimer&&(window.clearTimeout(this.autoHideTimer),this.autoHideTimer=null),this.state=null}};const R={system:{background:{foreground:"white",background:"#000080"},menuBar:{active:{foreground:"black",background:"#AAAAAA"},inactive:{foreground:"black",background:"#AAAAAA"}}},menuBar:{active:{foreground:"black",background:"#AAAAAA"},inactive:{foreground:"black",background:"#AAAAAA"}},window:{border:{active:{foreground:"yellow",background:"#AAAAAA"},inactive:{foreground:"gray",background:"#AAAAAA"}},background:{active:{foreground:"white",background:"#00AAAA"},inactive:{foreground:"gray",background:"#00AAAA"}},shadow:{foreground:"gray",background:"black"},scrollbar:{foreground:"white",background:"#000080"}},dialog:{border:{foreground:"white",background:"DarkMagenta"},background:{foreground:"white",background:"DarkMagenta"},button:{active:{foreground:"yellow",background:"DarkMagenta"},inactive:{foreground:"white",background:"DarkMagenta"}}},screen:{foreground:"white",background:"#000080"}},b={close:"■",maximize:"≡",resize:".",scrollUp:"▲",scrollDown:"▼",scrollLeft:"◄",scrollRight:"►"},N={topLeft:"╔",topRight:"╗",bottomLeft:"╚",bottomRight:"╝",horizontal:"═",vertical:"║"},X={topLeft:" ",topRight:" ",bottomLeft:" ",bottomRight:" ",horizontal:" ",vertical:" "},C={black:0,blue:1,green:2,cyan:3,red:4,magenta:5,brown:6,lightgray:7,gray:8,darkgray:8,lightblue:9,lightgreen:10,lightcyan:11,lightred:12,lightmagenta:13,yellow:14,white:15,"#000000":0,"#0000AA":1,"#00AA00":2,"#00AAAA":3,"#AA0000":4,"#AA00AA":5,"#AA5500":6,"#AAAAAA":7,"#555555":8,"#5555FF":9,"#55FF55":10,"#55FFFF":11,"#FF5555":12,"#FF55FF":13,"#FFFF55":14,"#FFFFFF":15};function p(e){const t=e.toLowerCase().trim();if(t in C)return C[t];if(t.startsWith("#")){const i=parseInt(t.slice(1,3),16),s=parseInt(t.slice(3,5),16),r=parseInt(t.slice(5,7),16);let o=15,n=Number.MAX_VALUE;for(const[h,l]of Object.entries(C))if(h.startsWith("#")){const u=parseInt(h.slice(1,3),16),g=parseInt(h.slice(3,5),16),M=parseInt(h.slice(5,7),16),d=Math.sqrt(Math.pow(i-u,2)+Math.pow(s-g,2)+Math.pow(r-M,2));d<n&&(n=d,o=l)}return o}return 15}class ${constructor(t,i){this.isDirty=!0,this.animationFrameId=null,this.canvas=t,this.ctx=t.getContext("2d"),this.videoBuffer=i;const s=1.6;this.charWidth=Math.floor(t.width/i.getBufferData().width),this.charHeight=Math.floor(this.charWidth*s),this.canvas.height=this.charHeight*i.getBufferData().height,this.setupColorPalette()}setupColorPalette(){const t=["#000000","#0000AA","#00AA00","#00AAAA","#AA0000","#AA00AA","#AA5500","#AAAAAA","#555555","#5555FF","#55FF55","#55FFFF","#FF5555","#FF55FF","#FFFF55","#FFFFFF"],i=document.createElement("style");let s=`:root {
`;t.forEach((r,o)=>{s+=`  --color-${o}: ${r};
`}),s+="}",i.textContent=s,document.head.appendChild(i)}startRenderLoop(){const t=()=>{this.animationFrameId=requestAnimationFrame(t),this.isDirty&&(this.renderFrame(),this.isDirty=!1)};this.animationFrameId=requestAnimationFrame(t)}markDirty(){this.isDirty=!0,this.animationFrameId||this.startRenderLoop()}stopRenderLoop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}renderFrame(){const{width:t,height:i,cells:s}=this.videoBuffer.getBufferData();this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);for(let r=0;r<i;r++)for(let o=0;o<t;o++){const n=s[r][o]||{char:" ",attributes:{foreground:7,background:0,blink:!1}},h=getComputedStyle(document.documentElement).getPropertyValue(`--color-${n.attributes.background}`).trim();if(this.ctx.fillStyle=h,this.ctx.fillRect(o*this.charWidth,r*this.charHeight,this.charWidth,this.charHeight),n.char&&n.char.charCodeAt(0)>31){const l=getComputedStyle(document.documentElement).getPropertyValue(`--color-${n.attributes.foreground}`).trim();this.ctx.fillStyle=l;const u=Math.floor(this.charHeight*.8);this.ctx.font=`bold ${u}px monospace`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(n.char,o*this.charWidth+this.charWidth/2,r*this.charHeight+this.charHeight/2)}}}getCharacterDimensions(){return{width:this.charWidth,height:this.charHeight}}screenToBuffer(t,i){return{x:Math.floor(t*this.videoBuffer.getBufferData().width/this.canvas.width),y:Math.floor(i*this.videoBuffer.getBufferData().height/this.canvas.height)}}}class q{constructor(){this.cache=new Map}generateWindowHash(t){return JSON.stringify({position:t.position,size:t.size,title:t.title,isActive:t.isActive,isMaximized:t.isMaximized,scrollPosition:t.scrollPosition})}needsRedraw(t){const i=this.cache.get(t.id);return i?this.generateWindowHash(t)!==i.hash:!0}getContent(t){const i=this.cache.get(t);return i?i.content:null}update(t,i,s){this.cache.set(t.id,{id:t.id,content:i,region:s,lastUpdate:Date.now(),hash:this.generateWindowHash(t)})}remove(t){this.cache.delete(t)}getRegion(t){const i=this.cache.get(t);return i?i.region:null}regionsOverlap(t,i){return!(t.x+t.width<=i.x||i.x+i.width<=t.x||t.y+t.height<=i.y||i.y+i.height<=t.y)}getOverlappingWindows(t){const i=[];for(const[s,r]of this.cache.entries())this.regionsOverlap(t,r.region)&&i.push(s);return i}clear(){this.cache.clear()}getLastUpdate(t){const i=this.cache.get(t);return i?i.lastUpdate:0}isCached(t){return this.cache.has(t)}getCachedWindowIds(){return Array.from(this.cache.keys())}calculateCacheSize(){let t=0;for(const i of this.cache.values())t+=i.content.reduce((s,r)=>s+r.length*10,0);return t}cleanup(t){const i=Date.now();for(const[s,r]of this.cache.entries())i-r.lastUpdate>t&&this.cache.delete(s)}}class G{constructor(t,i,s){this.windows=[],this.activeWindow=null,this.onWindowCreated=null,this.onWindowClosed=null,this.onWindowUpdated=null,this.videoBuffer=t,this.theme=i,this.windowCache=new q,this.layerManager=s}convertColors(t){return{foreground:p(t.foreground),background:p(t.background)}}createSystemWindow(t){return this.windows.push(t),t.id}createWindow(t,i,s,r={}){const o=`window-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,n={id:o,title:t,position:i,size:s,isActive:!1,isMaximized:!1,isMinimized:!1,hasScrollbars:!1,scrollPosition:{x:0,y:0},borderless:r.borderless||!1,shadowless:r.shadowless||!1};return this.windows.push(n),this.setActiveWindow(o),this.onWindowCreated&&this.onWindowCreated(),o}createDialog(t,i,s,r){const o=`dialog-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,n={id:o,title:t,position:i,size:s,isActive:!1,isMaximized:!1,isMinimized:!1,hasScrollbars:!1,scrollPosition:{x:0,y:0},type:"dialog",buttons:r,selectedButton:0};return this.windows.push(n),this.setActiveWindow(o),o}setActiveWindow(t,i=!0){const s=this.windows.find(r=>r.id===t);if(s?.type!=="system"){if(this.activeWindow){const r=this.windows.find(o=>o.id===this.activeWindow);r&&(r.isActive=!1)}s&&(i&&(this.windows=this.windows.filter(r=>r.id!==t),this.windows.push(s)),s.isActive=!0,this.activeWindow=t,this.onWindowUpdated&&this.onWindowUpdated())}}writeChar(t,i,s,r){const o=this.videoBuffer.getBufferData();t>=0&&t<o.width&&i>=0&&i<o.height&&this.videoBuffer.writeChar(t,i,s,r)}getChar(t,i){try{return this.videoBuffer.getChar(t,i)}catch{return null}}drawShadow(t){const i=this.convertColors(this.theme.window.shadow),s=this.layerManager.createShadowRegion(t);for(let r=s.y;r<s.y+s.height;r++)for(let o=s.x;o<s.x+s.width;o++){const n=this.getChar(o,r);n&&this.writeChar(o,r,n.char,i)}}drawWindow(t){const{position:i,size:s,title:r,isActive:o,isMinimized:n}=t,h=t.type==="dialog",l=t.type==="system",u={x:i.x,y:i.y,width:s.width,height:s.height};if(!t.isMaximized&&!n&&!t.shadowless&&!l&&this.drawShadow(u),!this.windowCache.needsRedraw(t)){const d=this.windowCache.getContent(t.id);if(d){for(let a=0;a<d.length;a++)for(let c=0;c<d[a].length;c++){const w=d[a][c];w&&this.writeChar(i.x+c,i.y+a,w.char,w.attributes)}return}}const g=Array(s.height).fill(null).map(()=>Array(s.width).fill(null)),M=this.convertColors(l?t.role==="background"?this.theme.system.background:this.theme.system.menuBar.inactive:h?this.theme.dialog.background:o?this.theme.window.background.active:this.theme.window.background.inactive);if(!t.borderless){const d=h?N:X,a=this.convertColors(h?this.theme.dialog.border:o?this.theme.window.border.active:this.theme.window.border.inactive);for(let c=0;c<s.width;c++)g[0][c]={char:d.horizontal,attributes:a},this.writeChar(i.x+c,i.y,d.horizontal,a),g[s.height-1][c]={char:d.horizontal,attributes:a},this.writeChar(i.x+c,i.y+s.height-1,d.horizontal,a);for(let c=1;c<s.height-1;c++)g[c][0]={char:d.vertical,attributes:a},this.writeChar(i.x,i.y+c,d.vertical,a),g[c][s.width-1]={char:d.vertical,attributes:a},this.writeChar(i.x+s.width-1,i.y+c,d.vertical,a);if(g[0][0]={char:d.topLeft,attributes:a},g[0][s.width-1]={char:d.topRight,attributes:a},g[s.height-1][0]={char:d.bottomLeft,attributes:a},g[s.height-1][s.width-1]={char:d.bottomRight,attributes:a},this.writeChar(i.x,i.y,d.topLeft,a),this.writeChar(i.x+s.width-1,i.y,d.topRight,a),this.writeChar(i.x,i.y+s.height-1,d.bottomLeft,a),this.writeChar(i.x+s.width-1,i.y+s.height-1,d.bottomRight,a),r){const c=Math.floor((s.width-r.length)/2);for(let w=0;w<r.length;w++)g[0][c+w]={char:r[w],attributes:a},this.writeChar(i.x+c+w,i.y,r[w],a)}o&&!h&&!l&&(g[0][0]={char:b.close,attributes:a},this.writeChar(i.x,i.y,b.close,a),g[0][s.width-1]={char:b.maximize,attributes:a},this.writeChar(i.x+s.width-1,i.y,b.maximize,a),n||(g[s.height-1][s.width-1]={char:b.resize,attributes:a},this.writeChar(i.x+s.width-1,i.y+s.height-1,b.resize,a)))}if(!n)for(let d=t.borderless?0:1;d<(t.borderless?s.height:s.height-1);d++)for(let a=t.borderless?0:1;a<(t.borderless?s.width:s.width-1);a++)g[d][a]={char:" ",attributes:M},this.writeChar(i.x+a,i.y+d," ",M);if(h){const d=t;if(d.buttons.length>0){const a=s.height-2;let c=Math.floor((s.width-d.buttons.join("  ").length)/2);d.buttons.forEach((w,E)=>{const U=E===d.selectedButton,B=this.convertColors(U?this.theme.dialog.button.active:this.theme.dialog.button.inactive);for(let m=0;m<w.length;m++)g[a][c+m]={char:w[m],attributes:B},this.writeChar(i.x+c+m,i.y+a,w[m],B);c+=w.length+2})}}this.windowCache.update(t,g,u)}draw(){const t=new Set(this.windows.map(i=>i.id));this.windowCache.getCachedWindowIds().forEach(i=>{t.has(i)||this.windowCache.remove(i)}),this.windows.forEach(i=>{this.drawWindow(i)}),this.windowCache.cleanup(5e3)}closeWindow(t){const i=this.windows.find(r=>r.id===t);if(!i||i.type==="system")return;const s=this.windows.findIndex(r=>r.id===t);if(s!==-1){const{position:r,size:o}=i,n={x:r.x,y:r.y,width:o.width,height:o.height};if(this.layerManager.markWindowAndShadowDirty(n),this.windowCache.remove(t),this.windows.splice(s,1),this.onWindowClosed&&this.onWindowClosed(),this.activeWindow===t){const h=[...this.windows].reverse().find(l=>l.type!=="system");if(this.activeWindow=h?h.id:null,this.activeWindow){const l=this.windows.find(u=>u.id===this.activeWindow);if(l){const u={x:l.position.x,y:l.position.y,width:l.size.width,height:l.size.height};this.layerManager.markWindowAndShadowDirty(u),this.windowCache.remove(this.activeWindow)}}}this.windows.forEach(h=>{const l={x:h.position.x,y:h.position.y,width:h.size.width,height:h.size.height};this.regionsIntersect(n,l)&&(this.layerManager.markWindowAndShadowDirty(l),this.windowCache.remove(h.id))})}}regionsIntersect(t,i){return!(i.x>=t.x+t.width||i.x+i.width<=t.x||i.y>=t.y+t.height||i.y+i.height<=t.y)}updateWindowPosition(t,i){const s=this.windows.find(r=>r.id===t);if(s){const r={x:s.position.x,y:s.position.y,width:s.size.width,height:s.size.height};this.layerManager.markWindowAndShadowDirty(r),s.position=i;const o={x:i.x,y:i.y,width:s.size.width,height:s.size.height};this.layerManager.markWindowAndShadowDirty(o),this.windowCache.remove(t),this.onWindowUpdated&&this.onWindowUpdated()}}updateWindowSize(t,i){const s=this.windows.find(r=>r.id===t);if(s){const r={x:s.position.x,y:s.position.y,width:s.size.width,height:s.size.height};this.layerManager.markWindowAndShadowDirty(r),s.size=i;const o={x:s.position.x,y:s.position.y,width:i.width,height:i.height};this.layerManager.markWindowAndShadowDirty(o),this.windowCache.remove(t),this.onWindowUpdated&&this.onWindowUpdated()}}toggleMinimize(t){const i=this.windows.find(r=>r.id===t);if(!i||i.type)return;const s={x:i.position.x,y:i.position.y,width:i.size.width,height:i.size.height};this.layerManager.markWindowAndShadowDirty(s),i.isMinimized?i.originalSize&&(i.size={...i.originalSize}):(i.originalSize={...i.size},i.size={width:i.size.width,height:1}),i.isMinimized=!i.isMinimized,this.windowCache.remove(t)}toggleMaximize(t){const i=this.windows.find(h=>h.id===t);if(!i||i.type)return;const{position:s,size:r,isMaximized:o}=i,n={x:s.x,y:s.y,width:r.width,height:r.height};if(this.layerManager.markWindowAndShadowDirty(n),i.isMaximized=!o,i.isMaximized){i.originalSize={...r},i.position={x:0,y:1},i.size={width:this.videoBuffer.getBufferData().width,height:this.videoBuffer.getBufferData().height-1};const h={x:0,y:1,width:i.size.width,height:i.size.height};this.layerManager.markWindowAndShadowDirty(h)}else i.originalSize&&(i.size={...i.originalSize},i.position={x:Math.floor((this.videoBuffer.getBufferData().width-i.size.width)/2),y:Math.floor((this.videoBuffer.getBufferData().height-i.size.height)/2)});this.windowCache.remove(t)}getWindows(){return[...this.windows]}getActiveWindow(){return this.windows.find(t=>t.id===this.activeWindow)||null}}var S=(e=>(e.Background="background",e.Shadow="shadow",e.Window="window",e.Cursor="cursor",e))(S||{});const I={x:2,y:1};class Q extends j{constructor(t,i){super(t,{width:t.getBufferData().width,height:t.getBufferData().height,maxDepth:4,maxObjects:10}),this.theme=i,this.layerIds={background:"background",shadow:"shadow",window:"window",cursor:"cursor"},this.initializeLayers()}registerFoxProLayer(t){super.registerLayer(t)}initializeLayers(){this.registerFoxProLayer({id:this.layerIds.background,type:"background",zIndex:0,visible:!0}),this.registerFoxProLayer({id:this.layerIds.shadow,type:"shadow",zIndex:1,visible:!0}),this.registerFoxProLayer({id:this.layerIds.window,type:"window",zIndex:2,visible:!0}),this.registerFoxProLayer({id:this.layerIds.cursor,type:"cursor",zIndex:3,visible:!0})}convertColors(t){return{foreground:p(t.foreground),background:p(t.background)}}createShadowRegion(t){return{x:t.x+I.x,y:t.y+I.y,width:t.width,height:t.height}}markWindowAndShadowDirty(t){this.markDirty(this.layerIds.window,t);const i=this.createShadowRegion(t);this.markDirty(this.layerIds.shadow,i),this.markDirty(this.layerIds.background,t),this.markDirty(this.layerIds.background,i)}clearBackground(){this.clearDirtyRegions(this.layerIds.background)}regionsIntersect(t,i){return!(i.x>=t.x+t.width||i.x+i.width<=t.x||i.y>=t.y+t.height||i.y+i.height<=t.y)}draw(){const t=Array.from(this.layers.values()).sort((i,s)=>i.zIndex-s.zIndex);for(const i of t)if(i.visible)switch(i.type){case"background":this.clearBackground();break;case"shadow":case"window":break;case"cursor":this.getDirtyRegions(this.layerIds.cursor).forEach(r=>{const o=this.getVisibleRegion(r);o&&(this.getDirtyRegions(this.layerIds.window).some(h=>this.regionsIntersect(o,h))||this.markDirty(this.layerIds.background,o))}),this.clearDirtyRegions(this.layerIds.cursor);break}}updateTheme(t){this.theme=t,this.markDirty(this.layerIds.background,{x:0,y:0,width:this.bufferSize.width,height:this.bufferSize.height})}}class J{constructor(t,i,s,r,o=R){this.unsubscribe=null,this.backgroundWindowId=null,this.menuBarWindowId=null,this.dragState=null,this.resizeState=null,this.lastClickTime=0,this.lastClickWindow=null,this.lastCursorVisible=!0,this.videoBuffer=t,this.keyboard=i,this.mouse=s,this.theme=o,this.screenSize={width:t.getBufferData().width,height:t.getBufferData().height},this.workspaceSize={width:this.screenSize.width,height:this.screenSize.height-1},this.renderer=new $(r,t),this.layerManager=new Q(t,o),this._windowManager=new G(t,o,this.layerManager),this._windowManager.onWindowCreated=()=>this.markDirty(),this._windowManager.onWindowClosed=()=>this.markDirty(),this._windowManager.onWindowUpdated=()=>this.markDirty(),this.cursorManager=new Y({autoHideTimeout:3e3}),this.initializeScreen(),this.setupEventHandlers(),this.startRenderLoop()}get windowManager(){return this._windowManager}initializeScreen(){const t={id:`window-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"system",role:"background",title:"",position:{x:-1,y:0},size:{width:this.screenSize.width+2,height:this.screenSize.height+1},isActive:!1,isMaximized:!1,isMinimized:!1,hasScrollbars:!1,scrollPosition:{x:0,y:0},borderless:!0,shadowless:!0};if(this.backgroundWindowId=this._windowManager.createSystemWindow(t),this.backgroundWindowId)for(let s=0;s<this.screenSize.height;s++)for(let r=-1;r<this.screenSize.width+1;r++)this.writeChar(r,s," ",this.theme.system.background);const i={id:`window-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:"system",role:"menubar",title:"",position:{x:0,y:0},size:{width:this.screenSize.width,height:1},isActive:!1,isMaximized:!1,isMinimized:!1,hasScrollbars:!1,scrollPosition:{x:0,y:0},borderless:!0,shadowless:!0};if(this.menuBarWindowId=this._windowManager.createSystemWindow(i),this.menuBarWindowId){for(let o=0;o<this.screenSize.width;o++)this.writeChar(o,0," ",this.theme.menuBar.inactive);const s=[" System "," File "," Edit "," Database "," Record "," Program "," Window "];let r=0;s.forEach(o=>{this.renderText(r,0,[o],this.theme.menuBar.inactive),r+=o.length})}}setupEventHandlers(){this.unsubscribe=y.subscribe(t=>{if(t.source==="mouse"&&"position"in t.data){const{position:i,modifiers:s,isButtonDown:r}=t.data,o=this.videoBuffer.getChar(i.x,i.y);o&&(this.cursorManager.clear(),this.cursorManager.update(i,o),this.cursorManager.setVisible(!0),this.layerManager.markDirty(this.layerManager.layerIds[S.Cursor],{x:i.x,y:i.y,width:1,height:1}));let n=!0;switch(t.type){case f.MOUSE_MOVE:case f.MOUSE_DRAG:this.handleMouseMove(i);break;case f.MOUSE_DOWN:console.log("Mouse down at:",i);const h=this.windowManager.getWindows();let l=!1;for(let u=h.length-1;u>=0;u--){const g=h[u];if(this.isPointInWindow(i,g)){this.handleMouseClick(i,0,s),l=!0,n=!0;break}}!l&&i.y===0&&(this.handleMouseClick(i,0,s),n=!0);break;case f.MOUSE_UP:(this.dragState||this.resizeState)&&(this.handleMouseUp(),n=!0);break;case f.MOUSE_DOUBLE_CLICK:this.handleDoubleClick(i),n=!0;break}n&&this.markDirty()}else if(t.source==="keyboard"&&t.type===f.KEY_DOWN){const{key:i,modifiers:s}=t.data;this.handleKeyPress(i,s),this.cursorManager.handleKeyPress()}},{eventTypes:[f.MOUSE_MOVE,f.MOUSE_DOWN,f.MOUSE_UP,f.MOUSE_DRAG,f.MOUSE_DOUBLE_CLICK,f.KEY_DOWN],minPriority:100})}convertColors(t){return{foreground:p(t.foreground),background:p(t.background)}}writeChar(t,i,s,r){t>=this.screenSize.width||i<0||i>=this.screenSize.height||this.videoBuffer.writeChar(t,i,s,this.convertColors(r))}handleMouseMove(t){if(this.dragState){const i=t.x-this.dragState.startPos.x,s=t.y-this.dragState.startPos.y;this.windowManager.updateWindowPosition(this.dragState.windowId,{x:this.dragState.offset.x+i,y:Math.max(1,this.dragState.offset.y+s)})}if(this.resizeState){const i=t.x-this.resizeState.startPos.x,s=t.y-this.resizeState.startPos.y,r=Math.max(20,this.resizeState.startSize.width+i),o=Math.max(10,this.resizeState.startSize.height+s);this.windowManager.updateWindowSize(this.resizeState.windowId,{width:r,height:o})}if(t.y===0&&this.menuBarWindowId){let i=0;const s=[" System "," File "," Edit "," Database "," Record "," Program "," Window "];let r=!1;for(const o of s)t.x>=i&&t.x<i+o.length?(this.renderText(i,0,[o],this.theme.menuBar.active),r=!0):this.renderText(i,0,[o],this.theme.menuBar.inactive),i+=o.length;if(!r){let o=0;s.forEach(n=>{this.renderText(o,0,[n],this.theme.menuBar.inactive),o+=n.length})}}this.markDirty()}drawMouseCursor(){const t=this.mouse.getState();if(!t.position||!t.isVisible)return;const i=this.cursorManager.getCursorDisplay();i&&(this.videoBuffer.writeChar(i.position.x,i.position.y,i.content.char,i.content.attributes),this.layerManager.markDirty(this.layerManager.layerIds[S.Cursor],{x:i.position.x,y:i.position.y,width:1,height:1}))}handleDoubleClick(t){const i=this.windowManager.getWindows();for(let s=i.length-1;s>=0;s--){const r=i[s];if(this.isPointInWindow(t,r)&&r.isActive&&t.y===r.position.y){this.windowManager.toggleMinimize(r.id),this.markDirty();return}}}handleMouseClick(t,i,s){const r=this.windowManager.getWindows();if(!(this.dragState||this.resizeState)){if(t.y===0&&this.menuBarWindowId){let o=0;const n=[" System "," File "," Edit "," Database "," Record "," Program "," Window "];for(const h of n){if(t.x>=o&&t.x<o+h.length){this.renderText(o,0,[h],this.theme.menuBar.active);return}o+=h.length}return}for(let o=r.length-1;o>=0;o--){const n=r[o];if(!(n.id===this.backgroundWindowId||n.id===this.menuBarWindowId)&&this.isPointInWindow(t,n)){const h=n.isActive,l=!!s?.shift;if(t.y===n.position.y){const u=t.x>n.position.x&&t.x<n.position.x+n.size.width-1;if(!h&&l&&u){this.dragState={windowId:n.id,startPos:t,offset:{x:n.position.x,y:n.position.y}};return}if(!h&&!l&&(this.windowManager.setActiveWindow(n.id,!0),u&&(this.dragState={windowId:n.id,startPos:t,offset:{x:n.position.x,y:n.position.y}})),h){if(t.x===n.position.x){this.windowManager.closeWindow(n.id),this.markDirty();return}if(t.x===n.position.x+n.size.width-1){this.windowManager.toggleMaximize(n.id),this.markDirty();return}u&&(this.dragState={windowId:n.id,startPos:t,offset:{x:n.position.x,y:n.position.y}})}}if(h&&t.x===n.position.x+n.size.width-1&&t.y===n.position.y+n.size.height-1){this.resizeState={windowId:n.id,startPos:t,startSize:{...n.size}};return}!h&&!l&&!this.dragState&&this.windowManager.setActiveWindow(n.id,!0);break}}this.lastClickWindow=null,this.lastClickTime=0}}handleMouseUp(){if(this.dragState=null,this.resizeState=null,this.menuBarWindowId){let t=0;[" System "," File "," Edit "," Database "," Record "," Program "," Window "].forEach(s=>{this.renderText(t,0,[s],this.theme.menuBar.inactive),t+=s.length})}this.markDirty(),this.lastClickWindow=null,this.lastClickTime=0}isPointInWindow(t,i){return t.x>=i.position.x&&t.x<i.position.x+i.size.width&&t.y>=i.position.y&&t.y<i.position.y+i.size.height}handleKeyPress(t,i){}fillBackground(){if(this.backgroundWindowId){for(let t=0;t<this.screenSize.height;t++)for(let i=-1;i<this.screenSize.width+1;i++)this.writeChar(i,t," ",this.theme.screen);this.markDirty()}}updateScreenSize(t,i){this.screenSize={width:t,height:i},this.workspaceSize={width:t,height:i-1},this.backgroundWindowId&&(this._windowManager.updateWindowPosition(this.backgroundWindowId,{x:-1,y:0}),this._windowManager.updateWindowSize(this.backgroundWindowId,{width:this.screenSize.width+2,height:this.screenSize.height+1}),this.fillBackground()),this.menuBarWindowId&&this._windowManager.updateWindowSize(this.menuBarWindowId,{width:this.screenSize.width,height:1})}getScreenSize(){return{...this.screenSize}}getWorkspaceSize(){return{...this.workspaceSize}}setTheme(t){this.theme=t,this.layerManager.updateTheme(t),this.initializeScreen()}getTheme(){return this.theme}update(){this.videoBuffer.beginBatch(),this.layerManager.draw(),this.windowManager.draw(),this.drawMouseCursor(),this.videoBuffer.endBatch(),this.videoBuffer.flush()}startRenderLoop(){this.renderer.startRenderLoop();const t=()=>{const s=this.mouse.getState().isVisible&&this.cursorManager.isCurrentlyVisible();s!==this.lastCursorVisible&&(this.update(),this.renderer.markDirty(),this.lastCursorVisible=s),requestAnimationFrame(t)};requestAnimationFrame(t)}markDirty(){this.update(),this.renderer.markDirty()}getRenderer(){return this.renderer}renderText(t,i,s,r){const o=r||this.theme.screen;s.forEach((n,h)=>{for(let l=0;l<n.length;l++)this.writeChar(t+l,i+h,n[l],o)}),this.markDirty()}cleanup(){this.cursorManager.cleanup(),this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null),this.renderer&&this.renderer.stopRenderLoop()}}const k=document.getElementById("screen"),L=16,Z=Math.floor(L*1.6),O=80,P=25;k.width=O*L;k.height=P*Z;const tt=new K(O,P),v=new H,z=new A(k);v.initialize();z.initialize();const W=new J(tt,v,z,k,R);document.addEventListener("keydown",e=>{if(e.key==="n"||e.key==="N"){const t=Math.floor(Math.random()*40),i=Math.floor(Math.random()*15)+5;W.windowManager.createWindow("New Window",{x:t,y:i},{width:30,height:10})}});window.addEventListener("unload",()=>{v.cleanup(),z.cleanup()});W.windowManager.createWindow("Welcome to FoxPro UI",{x:5,y:5},{width:40,height:15});const it=["FoxPro UI Demo","","Press N to create new windows","","Window Controls:","  • Click title to focus","  • Drag title to move","  • Click × to close","  • Click ≡ to maximize","  • Drag . to resize"];W.renderText(7,6,it);
